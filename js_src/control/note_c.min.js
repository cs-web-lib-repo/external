class note_{constructor(){this.enum_edit_mode={edit:1,view:2},this.lcl_obj={},this.edit_mode=this.enum_edit_mode.view,this.note_seq=null,this.note_node=null,this.note_list_table=$("#note_list #note_list_table").DataTable({deferRender:!0,dom:"rtp",drawCallback:function(){},language:{emptyTable:'<span data-i18n="card:no data"></span>',paginate:{next:">",previous:"<"}},lengthMenu:[[10,25,50,100],[10,25,50,100]],autoWidth:!1,columnDefs:[{title:"#",targets:0,width:"3%",searchable:!1},{title:'<i class="far fa-play-circle fa-lg"></i>',targets:1,width:"5%",searchable:!1},{title:'<span data-i18n="card:card.title"></span>',targets:2,width:"40%"},{title:'<i class="fas fa-eye fa-lg"></i>',targets:3,width:"5%",searchable:!1,orderData:4},{title:"state_sort",targets:4,searchable:!1,visible:!1},{title:'<i class="far fa-clock fa-lg"></i>',targets:5,width:"5%",searchable:!1},{title:'<i class="fas fa-file fa-lg"></i>',targets:6,width:"5%",searchable:!1,orderData:8},{title:'<i class="fas fa-file-download fa-lg"></i>',targets:7,width:"5%",searchable:!1,orderData:9},{title:"cost_self_sort",targets:8,searchable:!1,visible:!1},{title:"cost_self_sort",targets:9,searchable:!1,visible:!1}]}),this.note_file_list_table=$("#tabs-note-file-list #file_list_table").DataTable({deferRender:!0,dom:"rtp",language:{emptyTable:'<span data-i18n="card:no data"></span>',paginate:{next:">",previous:"<"}},drawCallback:function(){i18n_update()},lengthMenu:[[10,25,50,100],[10,25,50,100]],autoWidth:!1,columnDefs:[{title:"#",targets:0,width:"10%",searchable:!1,orderable:!1},{title:"<span data-i18n='card:file.name'></span>",targets:1,width:"35%"},{title:"<span data-i18n='card:file.byte'></span>",targets:2,width:"5%",searchable:!1,orderData:3},{title:"oder_byte",targets:3,visible:!1,searchable:!1},{title:"<span data-i18n='card:file.time'></span>",targets:4,width:"20%",searchable:!1,orderData:5},{title:"oder_time",targets:5,searchable:!1,visible:!1},{title:"<i class='fas fa-trash fa-lg'></i>",targets:6,width:"5%",searchable:!1,orderable:!1},{title:"",targets:7,searchable:!1,visible:!1},{title:"",targets:8,searchable:!1,visible:!1},{title:"",targets:9,searchable:!1,visible:!1},{title:"",targets:10,searchable:!1,visible:!1},{title:"",targets:11,searchable:!1,visible:!1}]})}}let note=new note_;function note_node_click(e,t=!0,n=!0,o=0){if($(".tool-container #note_info_ready_btn").parents(".tool-container").remove(),null!=e&&"5"!=e.data.state){switch(e.setActive(),e.setSelected(),note.edit_mode=note.enum_edit_mode.view,note.note_seq=e.key,note.note_node=e,$("#note-tabs").tabs("enable"),$("#note_split_right #breadcrumb >").remove(),set_breadcrumb(e.parent,$("#note_split_right #breadcrumb")),tree_breadcrumb_dropdown($("#note_split_right #breadcrumb"),e),init.current_note_sub_tab){case init.note_tabs_enum.info:note_get_info_timeline(main_note_info_timeline,e.key);break;case init.note_tabs_enum.list:note_get_note_list(main_note_list,e.key);break;case init.note_tabs_enum.file:note_get_note_file(e.key);break;case init.note_tabs_enum.calendar:note_get_schedule(e.key);break;default:note_get_info_timeline(main_note_info_timeline,e.key)}split_collapse(init.note_split,o),breadcrumb_path_reset($("#note_split_right #breadcrumb"),init.enum_bread_type.note),$("#note_split_right").scrollTop(0),n&&set_history(init.current_main_tab,note.note_seq,null)}}$(document).on("click","#note_tree_option #bookmark_list_btn",(function(){note_get_bookmark()})),$(document).on("click","#note_tree_option #tree_reload_btn",(function(){let e=$("#note_tree").fancytree("getTree"),t=$("#note_tree").fancytree("getTree").getFirstChild();tree_data.note_active_key=e.getActiveNode(),tree_data.note_select_key=e.getSelectedNodes()[0],tree_data.note_expand_list=[],tree_data.note_scroll_top=$("#"+e.rootNode.ul.id).scrollTop(),tree_refresh_target(e,t,tree_data.note_expand_list),$("#"+e.rootNode.ul.id).scrollTop(tree_data.note_scroll_top)})),$(document).on("click",".tool-container #note_title_asc_btn",(function(){$("#tabs-note #tree_sort_btn").trigger("click"),localStorage.note_tree_sort_type=tree_data.type_sort_enum.title_asc,tree_sort_icon($("#tabs-note #tree_sort_btn"),tree_data.enum_tree_type.note),node_sort($("#note_tree").fancytree("getTree").getFirstChild(),tree_data.type_sort_enum.title_asc)})),$(document).on("click",".tool-container #note_title_desc_btn",(function(){$("#tabs-note #tree_sort_btn").trigger("click"),localStorage.note_tree_sort_type=tree_data.type_sort_enum.title_desc,tree_sort_icon($("#tabs-note #tree_sort_btn"),tree_data.enum_tree_type.note),node_sort($("#note_tree").fancytree("getTree").getFirstChild(),tree_data.type_sort_enum.title_desc)})),$(document).on("click",".tool-container #note_utime_asc_btn",(function(){$("#tabs-note #tree_sort_btn").trigger("click"),localStorage.note_tree_sort_type=tree_data.type_sort_enum.utime_asc,tree_sort_icon($("#tabs-note #tree_sort_btn"),tree_data.enum_tree_type.note),node_sort($("#note_tree").fancytree("getTree").getFirstChild(),tree_data.type_sort_enum.utime_asc)})),$(document).on("click",".tool-container #note_utime_desc_btn",(function(){$("#tabs-note #tree_sort_btn").trigger("click"),localStorage.note_tree_sort_type=tree_data.type_sort_enum.utime_desc,tree_sort_icon($("#tabs-note #tree_sort_btn"),tree_data.enum_tree_type.note),node_sort($("#note_tree").fancytree("getTree").getFirstChild(),tree_data.type_sort_enum.utime_desc)})),$(document).on("click","#note_tree_filter_mode .close_setting",(function(){$("#note_tree_filter_mode").addClass("hidden"),$("#note_default_mode").removeClass("hidden"),$("#note_tree_filter_mode #filter_input").val(""),WebuiPopovers.updateContent($("#note_tree_filter_mode #filter_input"),'<ul class="card_search_ul list-group note_tree" data-i18n="card:no data">none</ul>')})),$(document).on("click",".card_search_ul.note_tree li",(function(){$(".card_search_ul.note_tree li").removeClass("active"),$(this).addClass("active"),note_node_click($("#note_tree").fancytree("getTree").getNodeByKey($(this).data("node_seq").toString()),!0),$("#note_tree_filter_mode #filter_input").focus(),0==init.is_web?(WebuiPopovers.hide("#note_tree_filter_mode #filter_input"),$("#note_tree_filter_mode #filter_input").blur()):$("#note_tree_filter_mode #filter_input").focus()})),$(document).on("click","#note_tree_fillter_btn",(function(){$("#note_tree_filter_mode").removeClass("hidden"),$("#note_default_mode").addClass("hidden"),$("#note_tree_filter_mode #filter_input").focus()})),$(document).on("keyup","#note_tree_filter_mode #filter_input",(function(e){switch(e.stopPropagation(),e.keyCode){case 13:if(0==$(".card_search_ul.note_tree li.active").length){const e=$(this).val();return void(1==/^-?\d+$/.test(e)&&(note_node_click($("#note_tree").fancytree("getTree").getNodeByKey(e),!0),$(this).focus()))}note_node_click($("#note_tree").fancytree("getTree").getNodeByKey($(".card_search_ul.note_tree li.active").data("node_seq").toString()),!0),0==init.is_web?(WebuiPopovers.hide("#note_tree_filter_mode #filter_input"),$("#note_tree_filter_mode #filter_input").blur()):$("#note_tree_filter_mode #filter_input").focus();break;case 27:WebuiPopovers.hide("#note_tree_filter_mode #filter_input");break;case 38:case 40:break;default:v_card_search($("#note_tree_filter_mode #filter_input").val(),$("#note_tree").fancytree("getTree"),$("#note_tree_filter_mode #filter_input"),"note_tree")}})),$(document).on("keydown","#note_tree_filter_mode #filter_input",(function(e){switch(e.stopPropagation(),e.keyCode){case 38:if(1==$(".card_search_ul.note_tree li").hasClass("active")){let e=$(".card_search_ul.note_tree li.active").prev();$(".card_search_ul.note_tree li.active").removeClass("active"),e.addClass("active"),e[0].scrollIntoViewIfNeeded(!1)}else $(".card_search_ul.note_tree li:last-child").addClass("active");break;case 40:if(1==$(".card_search_ul.note_tree li").hasClass("active")){let e=$(".card_search_ul.note_tree li.active").next();$(".card_search_ul.note_tree li.active").removeClass("active"),e.addClass("active"),e[0].scrollIntoViewIfNeeded(!1)}else $(".card_search_ul.note_tree li:first-child").addClass("active")}})),$(document).on("click","#note_tree_filter_mode #filter_btn",(function(){v_card_search($("#note_tree_filter_mode #filter_input").val(),$("#note_tree").fancytree("getTree"),$("#note_tree_filter_mode #filter_input"),"note_tree")})),$(document).on("click","#tabs-note #tree_back_btn",(function(){})),$(document).on("click","#note_info_ready_btn.tool-item",(function(){note_set_status(card_detail.type_status_enum.ready,note.note_seq)})),$(document).on("click","#note_info_progress_btn.tool-item",(function(){note_set_status(card_detail.type_status_enum.progress,note.note_seq)})),$(document).on("click","#note_info_stop_btn.tool-item",(function(){note_set_status(card_detail.type_status_enum.stop,note.note_seq)})),$(document).on("click","#note_info_cancel_btn.tool-item",(function(){note_set_status(card_detail.type_status_enum.cancel,note.note_seq)})),$(document).on("click","#note_info_complete_btn.tool-item",(function(){note_set_status(card_detail.type_status_enum.complete,note.note_seq)})),$(document).on("click","#note_btn_group #note_create_btn",(function(){let e=$("#note_tree").fancytree("getTree").getSelectedNodes()[0].key;$("#card_create_modal #contents_title_area h3").attr("data-i18n","modal:title.note create"),$("#card_create_modal #create_card_input").attr("data-i18n","[placeholder]modal:input.note title"),$("#card_create_modal").data("tree_type",tree_data.enum_tree_type.note),$("#card_create_modal #create_card_btn").data("card_seq",e),$("#card_create_modal #create_card_close_btn").data("card_seq",e),$("#card_create_modal #create_card_input").data("card_seq",e),$("#create_card_input").val(""),$("#card_create_modal").modal()})),$(document).on("click","#note_set_bookmark_btn",(function(){note_set_bookmark(note.note_seq)})),$(document).on("click","#note_del_bookmark_btn",(function(){note_del_bookmark(note.note_seq)})),$(document).on("click","#note_btn_group #note_title_btn",(function(){let e=$("#note_tree").fancytree("getTree").getSelectedNodes()[0],t=e.key;$("#card_title_modal #contents_title_area h3").attr("data-i18n","modal:title.note rename"),$("#card_title_modal #title_card_input").attr("data-i18n","[placeholder]modal:input.note title"),$("#card_title_modal").data("tree_type",tree_data.enum_tree_type.note),$("#card_title_modal #title_card_btn").data("card_seq",t),$("#card_title_modal #title_card_close_btn").data("card_seq",t),$("#card_title_modal #title_card_input").data("card_seq",t),$("#card_title_modal #title_card_input").val(e.title),$("#card_title_modal").modal()})),$(document).on("click","#note_detail .info_form #note_title_edit",(function(){let e=$(this).parent();const t=$(this).text().trim();$(this).remove(),e.append(`<div class="col-xs-9 compact_row">\n<input id="title_input" type="text" class="form-control input-sm" placeholder=""\nvalue="${t}" data-i18n="[placeholder]card:card title" maxlength="100">\n</div>`),$("#title_input",e).focus()})),$(document).on("keydown","#note_detail .info_form #title_input",(function(e){13==e.keyCode&&$(this).trigger("focusout")})),$(document).on("focusout","#note_detail .info_form #title_input",(function(){const e=$(this).val().trim();let t=$("#note_tree").fancytree("getTree").getSelectedNodes()[0];""!=e&&t.title!=e?note_set_title(e,t.key):$(this).val(t.title)})),$(document).on("click","#note_btn_group #note_move_modal_btn",(function(){let e=$("#note_tree").fancytree("getTree").getSelectedNodes()[0].key;$("#card_move_modal").data("tree_type",tree_data.enum_tree_type.note),v_card_duplication_tree($("#note_tree"),$("#move_tree")),$("#card_move_modal #card_move_btn").data("seq",e),$("#card_move_modal").modal()})),$(document).on("click","#note_btn_group #note_state_batch_btn",(function(){$("#note_tree").fancytree("getTree").getSelectedNodes()[0].getChildren();console.log($("#note_tree").fancytree("getTree").getSelectedNodes()[0]),console.log(note.note_node),$("#card_state_batch_select_modal").data("tree_type",tree_data.enum_tree_type.note),v_card_duplication_tree($("#note_tree"),$("#batch_tree"),note.note_node),$("#card_state_batch_modal #card_state_batch_btn").attr("disabled",!0),$("#card_state_batch_modal #all_select i").removeClass("fa-check-square"),$("#card_state_batch_modal #all_select i").removeClass("fa-square"),$("#card_state_batch_modal #all_select i").addClass("fa-square"),$("#card_state_batch_modal").modal(),$("#batch_tree").fancytree("getTree").visit((function(e){e.setExpanded(!0)}))})),$(document).on("click","#note_btn_group #note_move_batch_btn",(function(){let e=$("#note_tree").fancytree("getTree").getSelectedNodes()[0],t=e.getChildren();$("#card_move_modal").data("tree_type",tree_data.enum_tree_type.note),v_under_list($("#card_move_batch_modal"),t),v_card_duplication_tree($("#note_tree"),$("#move_tree")),$("#card_move_modal #card_move_btn").data("seq",e.key),$("#card_move_batch_modal #card_move_batch_btn").attr("disabled",!0),$("#card_move_batch_modal").modal()})),$(document).on("click","#note_btn_group #note_delete_btn",(function(){let e=$("#note_tree").fancytree("getTree").getSelectedNodes()[0].key;note_del_remove(e)})),$(document).on("click","#note_btn_group #note_recover_btn",(function(){let e=$("#note_tree").fancytree("getTree").getSelectedNodes()[0].key;note_set_recover(e)})),$(document).on("click","#tabs-note-info #info_area #note_seq_copy",(function(){get_web_link($(this),note.note_node,"note")})),$(document).on("click","#card_view_modal #note_seq_copy",(function(){let e=$(this).data("card_seq").toString(),t=$("#note_tree").fancytree("getTree").getNodeByKey(e),n={data:[init.main_tabs_enum.note,e,null]},o=window.location.origin+window.location.pathname+"?q="+encodeURIComponent(btoa(JSON.stringify(n)));get_web_link($(this),t,"note",o)})),$(document).on("click","#tabs-note-info #note_date_btn",(function(){$("#date_input_modal").data("tree_type",tree_data.enum_tree_type.note),$("#date_input_modal").data("seq",note.note_seq),v_date_input($("#date_input_modal"),moment.unix($(this).data("start_ts")),moment.unix($(this).data("end_ts")),$(this).data("is_allday"),$(this).data("is_repeat"),$(this).data("is_schedule")),$("#date_input_modal").modal()})),$(document).on("click","#card_view_modal #note_date_btn",(function(){$("#date_input_modal").data("tree_type",tree_data.enum_tree_type.note),$("#date_input_modal").data("seq",note.note_seq),v_date_input($("#date_input_modal"),moment.unix($(this).data("start_ts")),moment.unix($(this).data("end_ts")),$(this).data("is_allday"),$(this).data("is_repeat"),$(this).data("is_schedule")),$("#date_input_modal").modal()})),$(document).on("click","#tabs-note-info #schedule_del_btn",(function(e){e.stopPropagation(),note_del_schedule(note.note_seq)})),$(document).on("click","#note_contents #note_edit_btn",(function(){note.edit_mode=note.enum_edit_mode.edit,note_get_timeline()})),$(document).on("click","#note_contents #note_view_btn",(function(){note.edit_mode=note.enum_edit_mode.view,note_get_timeline()})),$(document).on("click","#tabs-note-info #note_contents #note_create_btn",(function(){timeline_set_article_section_create_note($(this).parents("#contents_area"),$(this).parents("#info_area").data("article_seq"),contents_data.type_section_enum.note,$(this).parents(".list-group-item").data("section_seq"))})),$(document).on("click","#tabs-note-list #note_list_search .search_btn",(function(){note.note_list_table.search($(this).parent().find(".search_input").val()).draw(),$("#tabs-note-list #note_list").scrollTop(0),$("#tabs-note-list #note_list").localize()})),$(document).on("keydown","#tabs-note-list #note_list_search input",(function(e){13==e.keyCode&&$("#tabs-note-list #note_list_search .search_btn").trigger("click")})),$("select.note_list_len").on("sumo:closed",(function(){note.note_list_table.page.len($(this).val()).draw(),$("#tabs-note-list #note_list").scrollTop(0),$("#tabs-note-list #note_list").localize()})),$(document).on("click","#tabs-note-list #note_list_hidden",(function(){note_get_note_list(main_note_list,$("#note_tree").fancytree("getTree").getSelectedNodes()[0].key)})),$("#note_list_option select.select_state").on("sumo:closing",(function(){note_get_note_list(main_note_list,$("#note_tree").fancytree("getTree").getSelectedNodes()[0].key)})),$(document).on("click","#note_list tbody tr",(function(e){e.preventDefault(),e.stopPropagation(),card_view_handle($(this).find("#view_contents_btn").data("card_seq").toString(),null,!1,tree_data.enum_tree_type.note)})),$(document).on("click","#tabs-note-file-list #include_under_btn",(function(){note_get_note_file(note.note_seq)})),$(document).on("click","#tabs-note-file-list #file_list_search #search_btn",(function(){note.note_file_list_table.search($(this).parent().find(".search_input").val()).draw(),$("#tabs-note-file-list #file_list").scrollTop(0),$("#tabs-note-file-list #file_list").localize()})),$(document).on("keydown","#tabs-note-file-list #file_list_search input",(function(e){13==e.keyCode&&$("#tabs-note-file-list #file_list_search #search_btn").trigger("click")})),$("#tabs-note-file-list select.file_list_len").on("sumo:closed",(function(){note.note_file_list_table.page.len($(this).val()).draw(),$("#tabs-note-file-list #file_list").scrollTop(0),$("#tabs-note-file-list #file_list").localize()})),$("#tabs-note-file-list select.select_pos").on("sumo:closing",(function(){note_get_note_file(note.note_seq)})),$(document).on("click","#note_detail #file_list #view_contents_btn",(function(e){e.preventDefault(),e.stopPropagation(),card_view_handle($(this).data("card_seq").toString(),null,!1,tree_data.enum_tree_type.note)})),$(document).on("click","#note_detail #file_list #del_file_btn",(function(){let e=this;cs_msg.swal_select((function(){$.ajax({url:"/del_file",method:"POST",data:{space_seq:space_seq,v_file_seq:[$(e).data("section_seq")]},success:function(t){0==t.ec?note.note_file_list_table.row($(e).parents("tr")).remove().draw():cs_msg.noti_err(t.ec)},dataType:"json"})}))})),$("#tabs-note select.calendar_state").on("sumo:closing",(function(){note_get_schedule(note.note_seq)})),$(document).on("click","#tabs-note #cal_today_btn",(function(){calendar.note_cal.today()})),$(document).on("click","#tabs-note #cal_jump_card_btn",(function(){const e=calendar.note_cal.getEventById($("#note_tree").fancytree("getTree").getSelectedNodes()[0].key);null!=e&&calendar.note_cal.gotoDate(e.start)}));