class message_{constructor(){this.message_seq=null,this.article_seq=null,this.message_create_data=null,this.message_item_data=null,this.checkbox_list=[],this.enum_state={normal:1,trash:2},this.enum_type={ready:[1],send:[2],recv:[3],all:[1,2,3]},this.enum_folder_seq={ready:-1,send:-2,recv:-3,trash:-4},this.current_folder=this.enum_folder_seq.ready,this.popover_option={trigger:"click",animation:"fade",width:"200",delay:{show:300,hide:300},cache:!1,arrow:!1,padding:!1,backdrop:!0,onShow:function(e){400<$(e).height()&&$(".webui-popover-content",e).height("400"),$(".webui-popover-content",e).width("200"),e.localize()},onHide:function(e){$("#message_controller #message_move_btn").webuiPopover("destroy")}},this.list_table=$("#message_list #message_table").DataTable({deferRender:!0,dom:"rtp",pageLength:10,language:{emptyTable:'<span data-i18n="card:no data"></span>',paginate:{next:">",previous:"<"}},lengthMenu:[[10,25,50,100],[10,25,50,100]],autoWidth:!1,order:[4,"desc"],columnDefs:[{targets:0,searchable:!1,orderable:!1,width:"1%",className:"dt-body-center",checkboxes:{selectRow:!0,stateSave:!1,selectAllCallback:function(e,t,s){$("#message_select_count").text(message.list_table.column(0).checkboxes.selected().length+" / "+message.list_table.rows()[0].length)},selectCallback:function(e,t,s){switch(message.list_table.columns(0).checkboxes.selected()[0].length){case 0:$("#message_controller .btn").attr("disabled",!0);break;case 1:{let e,t;message.list_table.columns(0).checkboxes.selected()[0].forEach((function(t){e=$(t).data("message_seq")})),t=$("#message_table tbody .active #message_item").data("message_seq"),$("#message_controller .btn").attr("disabled",!1),e!=t&&$("#message_type_btn_group .btn").attr("disabled",!0);break}default:$("#message_controller .btn").attr("disabled",!1),$("#message_type_btn_group .btn").attr("disabled",!0),$("#message_remove_btn").attr("disabled",!1)}$("#message_trash_clear_btn").attr("disabled",!1),$("#message_controller .back_btn").attr("disabled",!1)}}},{title:"",targets:1,searchable:!1,orderable:!1,width:"5%"},{title:"",targets:2,searchable:!1,orderable:!1,width:"5%"},{title:'<div class="pull-right">\n<span id="message_select_count">0</span>\n<span data-i18n="message:select count"></span>\n</div>',targets:3,width:"80%",searchable:!1,orderable:!1},{title:"",targets:4,width:"0%",searchable:!1,orderable:!0,visible:!1},{title:"",targets:5,width:"0%",searchable:!1,orderable:!1,visible:!1},{title:"",targets:6,width:"0%",searchable:!1,orderable:!1,visible:!1}],rowId:function(e){return"message_"+e[5]+"_type_"+e[6]},select:{style:"multi",selector:"td:first-child"},drawCallback:function(e){$("#message_table .recv_account").each((function(e,t){$(t).asBreadcrumbs("destroy"),$(t).asBreadcrumbs(init.account_asBreadcrumbs_opt),$(".dropdown > .plus_btn",t).append($(".breadcrumb-dropdown-menu > li:not(.is-hidden)",t).length)})),$("#message_list .account_drop #user_img").webuiPopover("destroy").webuiPopover(init.popover_option),i18n_update()}})}}let message=new message_;$(document).on("click","#message_folder_list .list-group-item",(function(){$("#tabs-message .list-group-item").removeClass("active"),$(this).addClass("active"),message.current_folder=$(this).data("message_folder_seq"),split_collapse(init.message_split,0),set_history(init.current_main_tab,message.current_folder,[0,100,0]),message_get_list(message.current_folder),$("#message_controller").removeClass("hidden"),$("#message_split_center").scrollTop(0)})),$(document).on("click","#tabs-message #message_folder_create",(function(){$("#message_folder_create_modal").modal()})),$(document).on("click","#message_folder_create_modal #message_folder_create_btn",(function(){set_message_folder_create($("#create_folder_input").val())})),$(document).on("click",".webui-popover #message_folder_rename_btn",(function(){WebuiPopovers.hideAll(),$("#message_folder_rename_modal #message_folder_rename_apply").data("message_folder_seq",$(this).parent().data("message_folder_seq")),$("#message_folder_rename_modal #folder_rename_input").attr("placeholder",$(this).data("message_folder_name")),$("#message_folder_rename_modal").modal()})),$(document).on("click","#message_folder_rename_modal #message_folder_rename_apply",(function(){set_message_folder_rename($(this).data("message_folder_seq"),$("#message_folder_rename_modal #folder_rename_input").val())})),$(document).on("click",".webui-popover #message_folder_remove_btn",(function(){del_message_folder_remove($(this).parent().data("message_folder_seq"),!1)})),$(document).on("click","#message_table tbody tr td:not(.dt-checkboxes-cell)",(function(){let e=$(this).parent();$("#message_table tbody tr").removeClass("active"),e.addClass("active");let t=$("#message_item",e).data("message_seq");message.list_table.columns(0).checkboxes.deselectAll(),message.list_table.cell($("td:first-child",e)).checkboxes.select(),set_history(init.current_main_tab,t,[0,0,100]),get_message_item($("#message_item",e).data("message_seq"),v_message_item,$("#message_item",e).data("message_type")),split_collapse(init.message_split,1),$("#message_split_right").scrollTop(0)})),$(document).on("click","#message_table tbody tr td.dt-checkboxes-cell",(function(e){e.preventDefault(),e.stopPropagation(),$(this).parent().removeClass("selected")})),$(document).on("page.dt","#message_table",(function(){message.list_table.columns(0).checkboxes.deselectAll(),$("#message_table tbody tr").removeClass("active")})),$(document).on("click","#message_controller #message_remove_btn",(function(){let e=[],t=[];message.list_table.columns(0).checkboxes.selected()[0].forEach((function(s){e.push($(s).data("message_seq")),t.push($(s).data("message_type"))})),del_check_message_remove(e,t)})),$(document).on("click","#message_controller #message_move_btn",(function(){get_message_folder_list(v_move_folder,$(this),$(this).data("message_seq"),$(this).data("message_type"))})),$(document).on("click",".webui-popover .message_folder_list .list-group-item.target_folder",(function(){$(".webui-popover .message_folder_list .list-group-item.target_folder").removeClass("active"),$(this).addClass("active")})),$(document).on("click",".webui-popover #message_folder_move_btn",(function(){let e=[],t=[];message.list_table.columns(0).checkboxes.selected()[0].forEach((function(s){e.push($(s).data("message_seq")),t.push($(s).data("message_type"))})),set_message_move(e,t,$(".webui-popover .target_folder.active").data("message_folder_seq"))})),$(document).on("click",".webui-popover #message_read_btn",(function(){WebuiPopovers.hideAll();let e=[],t=[];message.list_table.columns(0).checkboxes.selected()[0].forEach((function(s){e.push($(s).data("message_seq")),t.push($(s).data("message_type"))})),set_message_read(e,t,!0)})),$(document).on("click",".webui-popover #message_unread_btn",(function(){WebuiPopovers.hideAll();let e=[],t=[];message.list_table.columns(0).checkboxes.selected()[0].forEach((function(s){e.push($(s).data("message_seq")),t.push($(s).data("message_type"))})),set_message_read(e,t,!1)})),$(document).on("click","#message_controller #message_trash_clear_btn",(function(){del_message_trash_clear()})),$(document).on("click","#message_controller #message_edit_btn",(function(){let e=$("#message_table tbody tr.active #message_item");get_message_item(e.data("message_seq"),v_message_edit,e.data("message_type"))})),$(document).on("click","#message_controller #message_send_btn",(function(){0==message.message_item_data.json__account_seq[0].length?cs_msg.swal_err("none account"):set_message_send(message.message_item_data.message_seq[0])})),$(document).on("click","#message_controller .back_btn",(function(){100==init.message_split.getSizes()[1]&&(init.message_split.setSizes([100,0,0]),$("#message_controller").addClass("hidden")),100==init.message_split.getSizes()[2]&&init.message_split.setSizes([0,100,0])})),$(document).on("click","#message_set_create",(function(){set_message_create()})),$(document).on("focusout","#message_create_modal #message_title",(function(){set_message_title(message.message_seq,$(this).val())})),$(document).on("click","#message_create_modal #add_to_btn",(function(){$("#multi_select_modal #contents_title_area h3").remove(),$("#multi_select_modal #contents_title_area").append('<h3 class="over_wrapper text-center" data-i18n="message:select recipients"></h3>'),$("#multi_select_modal .modal-footer >").remove(),$("#multi_select_modal .modal-footer").append('<span id="to_cancel_btn" class="pull-right btn btn-danger"\ndata-i18n="card:auth.cancel"></span>\n<span id="to_save_btn" class="pull-right btn btn-primary"\ndata-i18n="card:auth.apply"></span>');let e=[];$("#message_create_modal #message_right .unselect_btn").each((function(t,s){e.push($(s).data("account_seq"))})),v_account_select_tree($("#multi_select_modal #multi_select_list"),$("#multi_select_modal #multi_select_tree"),e),$("#multi_select_modal").localize(),$("#multi_select_modal").modal()})),$(document).on("click","#multi_select_modal #to_save_btn",(function(){let e=[];$("#multi_select_list >").each((function(t,s){e.push($(s).data("account_seq"))})),set_message_to_account(message.message_seq,e)})),$(document).on("click","#multi_select_modal #to_cancel_btn",(function(){$("#multi_select_modal").modal("hide")})),$(document).on("click","#message_create_modal .unselect_btn",(function(){$(this).remove()})),$(document).on("click","#message_create_modal #message_send_btn",(function(){0==$("#message_create_modal #to_account_list > div").length?cs_msg.swal_err("none account"):set_message_send(message.message_seq)})),$(document).on("click",".webui-popover #message_reply_btn",(function(){WebuiPopovers.hideAll(),set_message_create($(this).data("message_seq"),message.message_item_data.from_account_seq)})),$(document).on("click",".webui-popover #message_allreply_btn",(function(){WebuiPopovers.hideAll();let e=Array.from(new Set(message.message_item_data.json__account_seq[0].concat(message.message_item_data.from_account_seq)));set_message_create($(this).data("message_seq"),e)})),$(document).on("click",".webui-popover #message_forward_btn",(function(){WebuiPopovers.hideAll(),$("#multi_select_modal #contents_title_area h3").remove(),$("#multi_select_modal #contents_title_area").append('<h3 class="over_wrapper text-center" data-i18n="message:select forward recipients"></h3>'),$("#multi_select_modal .modal-footer >").remove(),$("#multi_select_modal .modal-footer").append('<span id="to_cancel_btn" class="pull-right btn btn-danger"\ndata-i18n="card:auth.cancel"></span>\n<span id="to_forward_btn" class="pull-right btn btn-primary"\ndata-i18n="message:forward"></span>');let e=[];$("#message_create_modal #message_right .unselect_btn").each((function(t,s){e.push($(s).data("account_seq"))})),v_account_select_tree($("#multi_select_modal #multi_select_list"),$("#multi_select_modal #multi_select_tree"),e),$("#multi_select_modal").localize(),$("#multi_select_modal").modal()})),$(document).on("click","#multi_select_modal #to_forward_btn",(function(){message.message_item_data.json__account_seq[0].push(message.message_item_data.from_account_seq[0]),set_message_create($(this).data("message_seq"),message.message_item_data.json__account_seq[0])})),$(document).on("click","#message_create_modal #contents_area #edit_note",(function(){let e=$(this).parent().data("section_seq");v_section_edit($(this).parent()),$("#markdown_editor_modal").data("section_seq",e),$("#markdown_editor_modal").modal()})),$(document).on("click","#message_create_modal #del_section_btn",(function(){timeline_del_article_section($(this).parents(".list-group-item"))})),$(document).on("click","#message_create_modal #note_create_btn",(function(){timeline_set_article_section_create_note($(this).parents("#contents_area"),$(this).parents("#contents").data("article_seq"),contents_data.type_section_enum.note,$(this).parents(".list-group-item").data("section_seq"))})),$(document).on("click","#message_create_modal #file_create_btn",(function(){contents_data.target_front_seq=$(this).parents(".list-group-item").data("section_seq")}));