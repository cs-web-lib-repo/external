function noti_(){this.noti_type={card_create:1,card_rename:2,card_move:3,card_remove:4,card_remove_permanently:5,card_recover:6,card_priority:10,card_hidden_set:11,card_hidden_unset:12,card_status:13,card_per_done:14,card_lock_set:15,card_lock_unset:16,card_cost_add:20,card_cost_remove:21,card_cost_modify:22,card_owner:30,card_viewer:31,card_link_add:40,card_link_remove:41,card_contents:50,chat_new_message:100}}noti_.prototype.set_noti_msg=function(a,n,t,e,i,s,r){let l=JSON.parse(n),o=$(document.createDocumentFragment());switch(o.append(`<div class="between_flex">\n<div>\n${v_user_photo_drop(account_list.get_account(s),!0)}\n</div>\n<div id="noti_item" class="flex_item_default over_wrapper"></div>\n<small style="white-space: nowrap;">${moment_time(r)}</small>\n</div>`),$(".account_drop a",o).webuiPopover("destroy").webuiPopover(init.popover_option),a){case noti.noti_type.card_create:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-primary" data-i18n="noti:card.create"></span>\n</div>`),o;case noti.noti_type.card_rename:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-primary" data-i18n="noti:card.rename"></span>\n</div>\n<div class="over_wrapper">${l.from}</div>\n<div class="over_wrapper">${l.to}</div>`),o;case noti.noti_type.card_move:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div class="over_wrapper">\n<span class="label label-primary" data-i18n="noti:card.move"></span>\n${l.to.title}\n</div>`),o;case noti.noti_type.card_remove:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-warning" data-i18n="noti:card.del"></span>\n</div>`),o;case noti.noti_type.card_remove_permanently:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-danger" data-i18n="noti:card.remove"></span>\n</div>`),o;case noti.noti_type.card_recover:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-warning" data-i18n="noti:card.recover"></span>\n</div>`),o;case noti.noti_type.card_priority:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-primary" data-i18n="noti:card.priority"></span>\n<span class="m_5">${select_priority_icon(l.from)}<i class="fas fa-arrow-right"></i>${select_priority_icon(l.to)}</span>\n</div>`),o;case noti.noti_type.card_hidden_set:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-primary" data-i18n="noti:card.hidden"></span>\n</div>`),o;case noti.noti_type.card_hidden_unset:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-primary" data-i18n="noti:card.unhidden"></span>\n</div>`),o;case noti.noti_type.card_status:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-primary" data-i18n="noti:card.state"></span>\n<span class="m_5">${select_state_icon(l.from)}<i class="fas fa-arrow-right"></i>${select_state_icon(l.to)}</span>\n</div>`),o;case noti.noti_type.card_per_done:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-primary" data-i18n="noti:card.per"></span>\n<span class="m_5">${l.from}%<i class="fas fa-arrow-right"></i>${l.to}%</span>\n</div>`),o;case noti.noti_type.card_lock_set:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-gold" data-i18n="noti:card.lock"></span>\n</div>`),o;case noti.noti_type.card_lock_unset:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-gold" data-i18n="noti:card.unlock"></span>\n</div>`),o;case noti.noti_type.card_cost_add:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-primary" data-i18n="noti:card.cost add"></span>\n<span class="m_5">${parseInt(l.to.cost_time/60)}h ${l.to.cost_time%60}m</span>\n</div>\n<div>${l.to.note}</div>`),o;case noti.noti_type.card_cost_remove:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-danger" data-i18n="noti:card.cost remove"></span>\n</div>\n<div>${l.from.note}</div>`),o;case noti.noti_type.card_cost_modify:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-primary" data-i18n="noti:card.cost modify"></span>\n<span class="m_5">${parseInt(l.from.cost_time/60)}h ${l.from.cost_time%60}m</span>\n<i class="fas fa-arrow-right"></i>\n<span class="m_5">${parseInt(l.to.cost_time/60)}h ${l.to.cost_time%60}m</span>\n</div>\n<div>${l.from.note}</div><div>${l.to.note}</div>`),o;case noti.noti_type.card_owner:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div style="height:auto;">\n<span class="label label-primary" data-i18n="noti:card.owner"></span>\n<span class="m_5">\n${v_user_photo_drop(account_list.get_account(l.from.account_seq[0]),!0)}\n\n<i class="fas fa-arrow-right"></i>\n${v_user_photo_drop(account_list.get_account(l.to.account_seq[0]),!0)}\n\n</span>\n</div>`),$(".account_drop a",o).webuiPopover("destroy").webuiPopover(init.popover_option),o;case noti.noti_type.card_viewer:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div style="height:auto;">\n<span class="label label-viewer" data-i18n="noti:card.viewer"></span>\n<span class="m_5"></span>\n</div>`),set_auth_select($(".m_5",o),l.to.account_seq,!0,3),o;case noti.noti_type.card_link_add:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-primary" data-i18n="noti:card.link add"></span>\n<span>${l.to.title}</span>\n</div>`),o;case noti.noti_type.card_link_remove:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-normal" data-i18n="noti:card.card"></span>\n${l.title}\n</div>\n<div>\n<span class="label label-danger" data-i18n="noti:card.link remove"></span>\n<span>${l.to.title}</span>\n</div>`),o;case noti.noti_type.card_contents:break;case noti.noti_type.chat_new_message:return $("#noti_item",o).append(`<div class="card_title over_wrapper">\n<span class="label label-warning" data-i18n="noti:msg"></span>\n${l.msg}\n</div>`),o}};let noti=new noti_;function v_notify(a){let n=$(document.createDocumentFragment());n.append('<div class="modal-body">\n<div id="noti_option" class="dropdown-header"></div>\n<div id="noti_list"></div>\n</div>');let t=a.msg.length;for(let e=0;e<t;++e)$("#noti_list",n).append(`<div class="noti_item" data-target_seq="${a.target_seq[e]}"\ndata-type_target="${a.type_target[e]}"\ndata-zlog_seq="${a.zlog_seq[e]}">\n</div>`),$(".noti_item:last",n).append(noti.set_noti_msg(a.type[e],a.msg[e],a.target_seq[e],a.type_target[e],a.zlog_seq[e],a.send_account_seq[e],a.ctime[e]));$("#noti_list_modal .modal-content").append(n),$("#noti_list_modal .modal-body").scroll((function(){let a=$(this).scrollTop(),n=$(this)[0].clientHeight,t=$(this)[0].scrollHeight;0<a&&t<=a+n&&(console.log($("#noti_list .noti_item:last",this),$("#noti_list .noti_item:last",this).data("zlog_seq")),get_notify(v_notify_append,$("#noti_list .noti_item:last",this).data("zlog_seq"),init.get_noti_count))}))}function v_notify_append(a){let n=$(document.createDocumentFragment()),t=a.msg.length;for(let e=0;e<t;++e)$(n).append(`<div class="noti_item" data-target_seq="${a.target_seq[e]}"\ndata-type_target="${a.type_target[e]}"\ndata-zlog_seq="${a.zlog_seq[e]}">\n</div>`),$(".noti_item:last",n).append(noti.set_noti_msg(a.type[e],a.msg[e],a.target_seq[e],a.type_target[e],a.zlog_seq[e],a.send_account_seq[e],a.ctime[e]));$("#noti_list_modal .modal-body #noti_list").append(n)}function get_notify(a=v_notify,n=0,t=init.get_noti_count){$.ajax({url:"/get_notify",method:"POST",data:{space_seq:space_seq,zlog_seq:n,count:t},success:function(n){0==n.ec?a(n.list_notify_info):cs_msg.noti_err(n.ec)},dataType:"json"})}$("#noti").on("click",(function(a){$("#noti_list_modal").modal("show")})),$("#noti_list_modal").on("show.bs.modal",(function(a){get_notify()})),$("#noti_list_modal").on("hidden.bs.modal",(function(a){$("#noti_list_modal .modal-body").remove()})),$(document).on("click","#noti_list .noti_item",(function(a){a.preventDefault(),a.stopPropagation();let n=$(this).data("target_seq");switch($(this).data("type_target")){case init.noti_type_enum.card:{let a=$("#tree").fancytree("getTree").getNodeByKey(n.toString());if(null==a)return swal.fire({title:'<span data-i18n="error:swal.none card"></span>'}),void $(".swal2-container").localize();1!=a.data.is_hidden&&1!=a.data.is_deleted||tree_data.tree_hidden||$("#hidden_btn").trigger("click"),$("#tabs").tabs({active:parseInt(init.main_tabs_enum.tree)}),list_node_click(a);break}case init.noti_type_enum.chat:org_room_create(n)}}));