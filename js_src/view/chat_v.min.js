function v_chat_room_list(e,s=null){$("#chat_room_list").remove(),$("#chat_slide").append('<div id="chat_room_list">\n<div id="list_search" class="cs_sticky between_flex">\n<span><i class="fas fa-search"></i></span>\n<input class="search" data-i18n="[placeholder]chat:member.search"  maxlength="100"/>\n</div>\n<div class="list"></div>\n</div>');const a=e.v_room_seq.length;for(let s=0;s<a;++s){let a=e.json__account_seq[s].indexOf(account_list.account.account_seq);if(e.json__account_seq[s].splice(a,1),e.v_room_type[s]==chat_data.enum_room_type.one){let a=account_list.get_account(e.json__account_seq[s][0]);if(null==a)continue;$("#chat_room_list .list").append(`<div data-room_seq="${e.v_room_seq[s]}" class="over_wrapper">\n<img src="${a.photo_url}" class="img-circle user_photo">\n<h5 class="room_title"> ${a.name}</h5>\n</div>`)}else{$("#chat_room_list .list").append(`<div data-room_seq="${e.v_room_seq[s]}" class="over_wrapper">\n<img src="/group_icon.jpg" class="img-circle">\n</div>`);const a=e.json__account_seq[s].length;let t="";for(let n=0;n<a;++n)t+=" "+account_list.get_account(e.json__account_seq[s][n]).name;$("#chat_room_list .list > div:last").append(`<h5 class="room_title">${t}</h5>`)}v_room_msg_count(e.v_room_seq[s],e.v_new_msg_count[s])}new List("chat_room_list",{valueNames:["room_title"]}),null!=chat_data.room_seq&&$(`#chat_room_list .list > div[data-room_seq="${chat_data.room_seq}"]`).addClass("active"),null!=s&&$(`#chat_room_list .list > div[data-room_seq="${s}"]`).trigger("click")}function v_chat_before(e,s){let a=$(document.createDocumentFragment());const t=e.msg_seq.length;let n=null;for(let s=0;s<t;++s){null==n&&(n=moment.unix(e.ctime[s])),0!=n.startOf("day").diff(moment.unix(e.ctime[s]).startOf("day"),"day")&&(a.prepend(`<div class="center_flex">\n<span class="moment_i18n border_box padding_5"\nstyle="border-radius: 10px; background-color: #ddd; opacity: 0.8;"\ndata-format="ll" data-time="${n.unix()}">\n${n.format("ll")}\n</span>\n</div>`),n=moment.unix(e.ctime[s]));let t=account_list.get_account(e.send_account_seq[s]);if(e.send_account_seq[s]==account_list.account.account_seq?a.prepend(`<div class="msg right" data-msg_seq="${e.msg_seq[s]}">\n<div class="msg_wrap">\n<div class="msg_box">\n<div class="lcl_list"></div>\n<div id="msg_note"></div>\n<div>\n<span class="moment_time label label-default pull-right" data-ctime="${e.ctime[s]}">${moment_time(e.ctime[s])}</span>\n</div>\n</div>\n<div id="user_photo" class="pull-right">\n${v_user_photo_drop(t,!0)}\n</div>\n</div>\n</div>`):a.prepend(`<div class="msg left" data-msg_seq="${e.msg_seq[s]}">\n<div class="msg_wrap">\n<div class="msg_box">\n<div class="lcl_list"></div>\n<div id="msg_note"></div>\n<div>\n<span class="moment_time label label-default pull-right" data-ctime="${e.ctime[s]}">${moment_time(e.ctime[s])}</span>\n</div>\n</div>\n<div id="user_photo" class="pull-left">\n${v_user_photo_drop(t,!0)}\n</div>\n</div>\n</div>`),$(".msg:first .account_drop a",a).webuiPopover("destroy").webuiPopover(init.popover_option),$(".msg_box:first #msg_note",a).text(e.note[s]),null!=e.file){const t=e.file.msg_seq.map(((e,s)=>({seq:e,index:s}))).filter((({seq:a})=>a===e.msg_seq[s])).map((({index:e})=>e));let n=0;t.forEach((function(s){$(".msg_box:first .lcl_list",a).append(`\n${v_file_preview(e.file.is_preview[s],e.file.file_seq[s],e.file.mimetype[s],e.file.name[s],e.file.size[s],n,"span")}\n`),1==e.file.is_preview[s]&&++n}))}0<e.unread_count[s]?$(".msg:first .msg_wrap",a).append(`<span id="read_count" class="label label-info has_count">${e.unread_count[s]}</span>`):$(".msg:first .msg_wrap",a).append('<span id="read_count" class="label label-success"><i class="fas fa-check"></i></span>'),chat_data.last_msg_seq=Math.max(chat_data.last_msg_seq,e.msg_seq[s]),0==chat_data.first_msg_seq?chat_data.first_msg_seq=e.msg_seq[s]:chat_data.first_msg_seq=Math.min(chat_data.first_msg_seq,e.msg_seq[s])}$("#receive_msg").prepend(a),$("#chat #chat_contents").animate({scrollTop:$("#chat #chat_contents").prop("scrollHeight")-s},10)}function v_chat_after(e){let s=account_list.get_account(e.send_account_seq),a=$(document.createDocumentFragment());const t=moment.unix($("#receive_msg .msg:last .moment_time").data("ctime")).startOf("day");let n=moment.unix(e.ctime);if(0!=t.diff(n.startOf("day"),"day")&&$("#receive_msg .msg:last").after(`<div class="center_flex">\n<span class="moment_i18n border_box padding_5"\nstyle="border-radius: 10px; background-color: #ddd; opacity: 0.8;"\ndata-format="ll" data-time="${e.ctime}">\n${n.format("ll")}\n</span>\n</div>`),a=0<e.unread_count?`<span id="read_count" class="label label-info has_count">${e.unread_count}</span>`:'<span id="read_count" class="label label-success"><i class="fas fa-check fa-lg"></i></span>',e.send_account_seq==account_list.account.account_seq?$("#receive_msg #dropzone_msg").before(`<div class="msg right" data-msg_seq="${e.msg_seq}">\n<div class="msg_wrap">\n<div class="msg_box">\n<div class="lcl_list"></div>\n<div id="msg_note"></div>\n<div>\n<span class="moment_time label label-default pull-right" data-ctime="${e.ctime}">${moment_time(e.ctime)}</span>\n</div>\n</div>\n<div id="user_photo" class="pull-right">\n${v_user_photo_drop(s,!0)}\n</div>\n${a}\n</div>\n</div>`):$("#receive_msg #dropzone_msg").before(`<div class="msg left" data-msg_seq="${e.msg_seq}">\n<div class="msg_wrap">\n<div class="msg_box">\n<div class="lcl_list"></div>\n<div id="msg_note"></div>\n<div>\n<span class="moment_time label label-default pull-right" data-ctime="${e.ctime}">${moment_time(e.ctime)}</span>\n</div>\n</div>\n<div id="user_photo" class="pull-left">\n${v_user_photo_drop(s,!0)}\n</div>\n${a}\n</div>\n</div>`),$("#receive_msg .msg:last .account_drop a").webuiPopover("destroy").webuiPopover(init.popover_option),$(".msg_box:last > #msg_note").text(e.note),null!=e.file){let s=0;for(let a=0;a<e.file.file_seq.length;++a)$(".msg_box:last > .lcl_list").append(`\n${v_file_preview(e.file.is_preview[a],e.file.file_seq[a],e.file.mimetype[a],e.file.name[a],e.file.size[a],s,"span")}\n`),1==e.file.is_preview[a]&&++s}if(chat_data.last_msg_seq=Math.max(chat_data.last_msg_seq,e.msg_seq),0!=e.msg_seq.length){let e=$("#chat #chat_contents");e.prop("scrollHeight")-e.scrollTop()-e.height()<300&&e.scrollTop(e.prop("scrollHeight"))}}function v_room_msg_count(e,s){$(`#chat_room_list .list > div[data-room_seq="${e}"] > .label`).remove(),0<s?$(`#chat_room_list .list > div[data-room_seq="${e}"]`).append(`<span class="label label-primary pull-right">${s}</span>`):$(`#chat_room_list .list > div[data-room_seq="${e}"]`).append(`<span class="label label-primary pull-right hidden">${s}</span>`)}function v_msg_unread(e){if(null==e.msg_seq)$(".msg_wrap .has_count").after('<span id="read_count" class="label label-success"><i class="fas fa-check fa-lg"></i></span>'),$(".has_count").remove();else{const s=e.msg_seq.length;for(let a=0;a<s;++a)$(`.msg[data-msg_seq="${e.msg_seq[a]}"] .msg_wrap #read_count`).remove(),0!=e.unread_count[a]?$(`.msg[data-msg_seq="${e.msg_seq[a]}"] .msg_wrap`).append(`<span id="read_count" class="label label-info has_count">${e.unread_count[a]}</span>`):$(`.msg[data-msg_seq="${e.msg_seq[a]}"] .msg_wrap`).append('<span id="read_count" class="label label-success"><i class="fas fa-check fa-lg"></i></span>')}}function v_msg_member(e,s){let a=$(document.createDocumentFragment());a.append('<ul class="chat_popover dropdown-menu"></ul>'),s.v_account_seq_unread.forEach((function(e){let s=account_list.get_account(e);$(".chat_popover",a).append(`<li class="dropdown-item" data-account_seq="${e}">\n<a>\n<img class="img-circle user_photo" src="${s.photo_url}"><span>${s.name}</span>\n</a>\n</li>`)})),e.webuiPopover("destroy").webuiPopover($.extend({},init.popover_option,{trigger:"click",content:a,onShow:function(e){s.v_account_seq_unread.forEach((function(s){let a=account_list.get_account(s),t="";a.account_seq==account_list.get_user_account().account_seq&&(t="disabled"),a.state!=account_list.enum_account_state.normal&&(t="disabled");let n=`<ul class='dropdown-menu'>\n<li id='drop_user_chat' class='dropdown-item ${t}' data-account_seq='${a.account_seq}'>\n<a><i class='far fa-comments'></i><span data-i18n='cs:account.chat'></span></a>\n</li>\n<li class='divider'></li>\n<li id='drop_user_info' class='dropdown-item' data-account_seq='${a.account_seq}'>\n<a><i class='fas fa-info-circle'></i><span data-i18n='cs:account.profile'></span></a>\n</li>\n</ul>`;$(`.chat_popover > li[data-account_seq="${s}"]`,e).webuiPopover("destroy").webuiPopover($.extend({},init.popover_option,{multi:!0,content:n,delay:{show:300,hide:0}}))})),e.localize()}})),e.webuiPopover("show")}function v_get_room_list_new_msg_count(e){$(`#chat_room_list .list > div[data-room_seq="${e.room_seq}"]`).prependTo($("#chat_room_list .list")),v_room_msg_count(e.room_seq,e.new_msg_count)}function v_room_msg_read_all(e){let s=$(`#chat_room_list .list > div[data-room_seq="${e}"]`);$(" > .label",s).remove(),s.append('<span class="label label-primary pull-right hidden">0</span>')}function v_leave(){0==chat_data.is_web&&chat_data.chat_split.collapse(1),$("#chat_contents").off("scroll"),$("#receive_msg >").remove(),$("#send_msg").addClass("hidden"),$("#chat_info >").remove(),$("#chat_info").removeClass("between_flex").addClass("center_flex"),$("#chat_info").append('<h3 id="chat_title" class="text-center over_wrapper"\ndata-i18n="chat:chat.select chat room">\n</h3>')}