class tree_data_{constructor(){this.expand_list=[],this.select_key=null,this.active_key=null,this.create_key=null,this.scroll_top=null,this.dblclick=!1,this.tree_hidden=!1,this.type_sort_enum={title_asc:"1",title_desc:"2",utime_asc:"3",utime_desc:"4"},this.enum_card_status={ready:1,progress:2,stop:3,cancel:4,complete:5,loading:6},this.note_expand_list=[],this.note_select_key=null,this.note_active_key=null,this.note_create_key=null,this.note_scroll_top=null,this.note_dblclick=!1,this.note_tree_hidden=!1,this.note_type_sort_enum={title:"1",utime:"2"},this.note_enum_card_status={ready:1,progress:2,stop:3,cancel:4,complete:5,loading:6},this.enum_tree_type={card:1,note:2,todo:3}}get_account_selected_seqs(e){let t=new Array;return e.getSelectedNodes().forEach((function(e){1==e.data.is_account&&-1==t.indexOf(e.data.account_seq)&&t.push(e.data.account_seq)})),t}}let tree_data=new tree_data_;function tree_sort_icon(e,t=tree_data.enum_tree_type.card){let a=null;switch(t==tree_data.enum_tree_type.card?(void 0===localStorage.tree_sort_type&&(localStorage.tree_sort_type=tree_data.type_sort_enum.utime_asc),a=localStorage.tree_sort_type):t==tree_data.enum_tree_type.note&&(void 0===localStorage.note_tree_sort_type&&(localStorage.note_tree_sort_type=tree_data.type_sort_enum.utime_asc),a=localStorage.note_tree_sort_type),$(e).removeClass("btn-toolbar-primary"),$(e).removeClass("btn-toolbar-normal"),$(e).removeClass("btn-toolbar-warning"),$(e).removeClass("btn-toolbar-info"),$("i",e).remove(),a){case tree_data.type_sort_enum.title_asc:$(e).addClass("btn-toolbar-primary").append('<i class="fas fa-lg fa-sort-alpha-down"></i>');break;case tree_data.type_sort_enum.title_desc:$(e).addClass("btn-toolbar-normal").append('<i class="fas fa-lg fa-sort-alpha-up"></i>');break;case tree_data.type_sort_enum.utime_asc:$(e).addClass("btn-toolbar-warning").append('<i class="fas fa-lg fa-sort-amount-down"></i>');break;case tree_data.type_sort_enum.utime_desc:$(e).addClass("btn-toolbar-info").append('<i class="fas fa-lg fa-sort-amount-up"></i>');break;default:$(e).addClass("btn-toolbar-primary").append('<i class="fas fa-lg fa-sort-alpha-down"></i>')}}function node_sort(e,t){e.sortChildren((function(e,a){switch(t){case tree_data.type_sort_enum.title_asc:return e.title.localeCompare(a.title);case tree_data.type_sort_enum.title_desc:return a.title.localeCompare(e.title);case tree_data.type_sort_enum.utime_asc:return e.data.card_sort_seq-a.data.card_sort_seq;case tree_data.type_sort_enum.utime_desc:return a.data.card_sort_seq-e.data.card_sort_seq;default:return e.title.localeCompare(a.title)}}),!0)}function make_map(e,t,a){let r=e[t],n=e[a],o=new Object;for(let e=0;e<r.length;++e)0==Array.isArray(o[n[e]])&&(o[n[e]]=new Array),o[n[e]].push(e);return o}function make_tree(e,t,a){let r=new Object;r.key=e.card_seq[a],r.title=e.title[a],r.type_member=e.type_member[a],r.is_hidden=e.is_hidden[a],r.is_owner=e.is_owner[a],r.is_lock=e.is_lock[a],r.is_deleted=e.is_deleted[a],r.is_todo=e.is_todo[a],r.status=e.status[a],r.priority=e.priority[a],r.per_done=e.per_done[a],r.card_sort_seq=e.card_sort_seq[a],r.tree_type=tree_data.enum_tree_type.card;let n=new Array;for(let r in t[e.card_seq[a]])n.push(make_tree(e,t,t[e.card_seq[a]][r]));return r.children=new Array,0!=n.length&&(r.children=n),r}function make_note_tree(e,t,a){let r=new Object;r.key=e.note_seq[a],r.title=e.title[a],r.is_deleted=e.is_deleted[a],r.status=e.status[a],r.card_sort_seq=e.utime_seq[a],r.tree_type=tree_data.enum_tree_type.note;let n=new Array;for(let r in t[e.note_seq[a]])n.push(make_note_tree(e,t,t[e.note_seq[a]][r]));return r.children=new Array,0!=n.length&&(r.children=n),r}function make_group_tree(e,t,a){let r=new Object;r.depth=e.depth[a],r.title=e.name[a],r.key=e.org_seq[a],r.porg_seq=e.porg_seq[a],r.v_account_seq=e.json__account_seq[a],r.is_account=!1,r.folder=!0;let n=new Array;for(let r in t[e.org_seq[a]])n.push(make_group_tree(e,t,t[e.org_seq[a]][r]));let o=!1;if(e.json__admin_account_seq[a].forEach((function(e){e!=account_list.account.account_seq||(o=!0)})),e.json__account_seq[a].forEach((function(t){let r=account_list.get_account(t),d=!1;e.json__admin_account_seq[a].forEach((function(e){e!=t||(d=!0)})),n.push({key:"a"+t,title:r.name,folder:!1,data:{url:r.photo_url,account_seq:t,is_account:!0,admin_seq:e.json__admin_account_seq[a],is_admin:d,is_member:o}})})),r.children=new Array,0!=n.length){r.children=n;let e=!1;for(let t=0;t<r.children.length;++t){if(0==r.children[t].folder){e=!1;break}null!=r.children[t].unselectableStatus&&(e=!0)}1==e&&(r.unselectableStatus=!1)}else r.unselectableStatus=!1;return r}function select_controll(e){try{if(!tree_data.tree_hidden){let t=e.getSelectedNodes()[0];if(null==t)return;let a=null;t.visitParents((function(e){1!=e.data.is_hidden&&1!=e.data.is_deleted||(a=e)}),!0),null!=a&&list_node_click(a.parent)}}catch(e){console.log(e)}}function info_contoll(e,t,a){e.getSelectedNodes()[0]==t&&(t.data.tree_type==tree_data.enum_tree_type.card&&(list_node_click(a,!0),1!=t.data.is_hidden&&1!=t.data.is_deleted||tree_data.tree_hidden||$("#hidden_btn").trigger("click")),t.data.tree_type==tree_data.enum_tree_type.note&&note_node_click(a,!0))}function tree_refresh_target(e,t,a){e.visit((function(e){1==e.isExpanded()&&a.push(e.key)})),t.resetLazy(),t.load(!0)}function tree_create(e,t){let a=e.getRootNode().getFirstChild();a.data.tree_type==tree_data.enum_tree_type.card?$.ajax({url:"/get_card_tree",method:"POST",data:{space_seq:space_seq,card_seq:t.s,target_account_seq:account_list.enum_account_self.self},success:function(t){if(0==t.ec){t=t.info;let a=e.getNodeByKey(t.pcard_seq[0].toString());a.addChildren({title:t.title[0],key:t.card_seq[0],data:{is_hidden:t.is_hidden[0],is_owner:t.is_owner[0],is_lock:t.is_lock[0],is_deleted:t.is_deleted[0],is_todo:t.is_todo[0],type_member:t.type_member[0],status:t.status[0],priority:t.priority[0],per_done:t.per_done[0],card_sort_seq:t.card_sort_seq[0],tree_type:tree_data.enum_tree_type.card}}),tree_data.create_key==t.card_seq[0].toString()&&a.visitParents((function(e){e.setExpanded(!0,{noAnimation:!0,noEvents:!0})}),!0),node_sort(a,localStorage.tree_sort_type)}else cs_msg.noti_err(t.ec)},dataType:"json"}):a.data.tree_type==tree_data.enum_tree_type.note&&$.ajax({url:"/note_get_note_tree",method:"POST",data:{space_seq:space_seq,note_seq:t.s,target_account_seq:account_list.enum_account_self.self},success:function(t){if(0==t.ec){let a=e.getNodeByKey(t.info.pnote_seq[0].toString());a.addChildren({title:t.info.title[0],key:t.info.note_seq[0],data:{is_deleted:t.info.is_deleted[0],status:t.info.status[0],card_sort_seq:t.info.utime_seq[0],tree_type:tree_data.enum_tree_type.note}}),a.visitParents((function(e){e.setExpanded(!0,{noAnimation:!0,noEvents:!0})}),!0),node_sort(a,localStorage.note_tree_sort_type)}else cs_msg.noti_err(t.ec)},dataType:"json"})}function tree_remove(e){e.visit((function(e){e.data.is_deleted=!0}),!0),e.render()}function tree_remove_permanently(e,t){t.remove()}function tree_item(e,t){e.data.tree_type==tree_data.enum_tree_type.card?(e.data.title=t.title,e.data.is_hidden=t.is_hidden,e.data.status=t.status,e.data.per_done=t.per_done,e.data.priority=t.priority,e.data.is_lock=t.is_lock,e.data.is_todo=t.is_todo,e.data.is_schedule=t.is_schedule,e.setTitle(t.title)):e.data.tree_type==tree_data.enum_tree_type.note&&(e.data.title=t.title,e.data.status=t.status,e.data.is_schedule=t.is_schedule,e.setTitle(t.title)),e.render()}function tree_breadcrumb_dropdown(e,t){$(".tree_breadcrumb_dropdown_ul").closest(".webui-popover").remove(),null==t.getChildren()?$(e).append(`<li class="nodepath">\n<a href="${t.key}" id="card_drop_btn" class="over_wrapper btn btn-sm btn-default" type="button" data-toggle="dropdown">\n${t.title}\n</a>\n</li>`):$(e).append(`<li class="nodepath">\n<a href="${t.key}" id="card_drop_btn" class="bread_tree_list over_wrapper btn btn-sm btn-default" type="button" data-toggle="dropdown" data-node_key="${t.key}">\n${t.title}<i class="fas fa-caret-down fa-lg"></i>\n</a>\n</li>`)}function get_tree_icon(e){if(null==e)return;let t="";if(tree_option.get_tree_option_status()||e.data.tree_type==tree_data.enum_tree_type.note)switch(e.data.status){case tree_data.enum_card_status.ready:t='<span class="far fa-circle text-dark" data-toggle="tooltip" data-placement="top" title="State : Ready"></span>';break;case tree_data.enum_card_status.progress:t='<span class="far fa-play-circle text-normal" data-toggle="tooltip" data-placement="top" title="State : Progress"></span>';break;case tree_data.enum_card_status.stop:t='<span class="far fa-pause-circle text-warning" data-toggle="tooltip" data-placement="top" title="State : Stop"></span>';break;case tree_data.enum_card_status.cancel:t='<span class="far fa-stop-circle text-danger" data-toggle="tooltip" data-placement="top" title="State : Cancel"></span>';break;case tree_data.enum_card_status.complete:t='<span class="far fa-check-circle text-success" data-toggle="tooltip" data-placement="top" title="State : Complete"></span>'}if(e.data.tree_type==tree_data.enum_tree_type.note)return t;let a="",r="";tree_option.get_tree_option_auth()&&(r=1==e.data.is_todo?"fa-running":"fa-user",a=e.data.type_member&card_detail.type_auth_enum.owner?`<span class="fas ${r} text-danger-o fa-fw" data-toggle="tooltip" data-placement="top" title="Auth : Owner"></span>`:e.data.type_member&card_detail.type_auth_enum.viewer?`<span class="fas ${r} text-primary-o fa-fw" data-toggle="tooltip" data-placement="top" title="Auth : Viewer"></span>`:`<span class="fas ${r} text-light fa-fw" data-toggle="tooltip" data-placement="top" title="Auth : None"></span>`);let n="";if(tree_option.get_tree_option_priority())switch(e.data.priority){case card_detail.type_priority_enum.urgent:n='<span class="fas fa-angle-double-up text-danger" data-toggle="tooltip" data-placement="top"\ndata-i18n="[title]tree:tree.priority.urgent" title="">\n</span>';break;case card_detail.type_priority_enum.high:n='<span class="fas fa-angle-up text-warning" data-toggle="tooltip" data-placement="top"\ndata-i18n="[title]tree:tree.priority.high" title="">\n</span>';break;case card_detail.type_priority_enum.medium:n='<span class="fas fa-minus text-primary" data-toggle="tooltip" data-placement="top"\ndata-i18n="[title]tree:tree.priority.medium" title="">\n</span>';break;case card_detail.type_priority_enum.low:n='<span class="fas fa-angle-down text-dark" data-toggle="tooltip" data-placement="top"\ndata-i18n="[title]tree:tree.priority.low" title="">\n</span>';break;case card_detail.type_priority_enum.lowest:n='<span class="fas fa-angle-double-down text-light" data-toggle="tooltip" data-placement="top"\ndata-i18n="[title]tree:tree.priority.lowest" title="">\n</span>'}let o="";return tree_option.get_tree_option_lock()&&(o=1==e.data.is_lock?'<span class="fas fa-lock text-gold" data-toggle="tooltip" data-placement="top" title="lock"></span>':'<span class="fas fa-unlock text-light" data-toggle="tooltip" data-placement="top" title="Auth :unlock"></span>'),`${a} ${t} ${n} ${o}`}function get_tree_title_color_class(e){return 1==e.data.is_deleted?"text-deleted":1==e.data.is_hidden?"text-hidden":""}function tree_rendering(e,t=tree_data.tree_hidden){if(!e.span)return;let a=$("#tree");e.data.tree_type==tree_data.enum_tree_type.card?a=$("#tree"):e.data.tree_type==tree_data.enum_tree_type.note&&(a=$("#note_tree")),$(e.span).find("span.state_icon").remove(),$(e.li).removeClass(),$(".fancytree-title",e.span).prepend('<span id="state_icon" class="state_icon"></span>');let r=parseInt($(".ui-fancytree > li > ul").css("padding-left"));if(0==$(".ui-fancytree > li > ul").length&&(r=21),!0===e.hasChildren()){let t=r*e.getLevel();$(".fancytree-expander",e.span).css("right",t),$(".fancytree-expander",e.span).css("padding-left",t),$(".state_icon",e.span).css("right",t-r)}else $(".fancytree-expander",e.span).css("padding-left",r);t?(1==e.data.is_hidden?$(".fancytree-title",e.span).addClass("fancytree-hidden"):$(".fancytree-title",e.span).removeClass("fancytree-hidden"),1==e.data.is_deleted?$(".fancytree-title",e.span).addClass("fancytree-deleted"):$(".fancytree-title",e.span).removeClass("fancytree-deleted")):"1"!=e.key&&(1==e.data.is_hidden||1==e.data.is_deleted?$(e.li).addClass("hidden"):$(e.li).removeClass("hidden")),$(e.span).find("span.state_icon").append(`${get_tree_icon(e)}`),$(e.span).find("#card_seq").remove(),$(e.span).append(`<span id="card_seq" class="hidden" data-card_seq="${e.key}"></span>`)}$((function(){$("#tabs-tree #tree_sort_btn").toolbar({content:"#tree_sort_toolbar",position:"bottom",style:"dark",animation:"flip",event:"click",hideOnClick:!0}),tree_sort_icon($("#tabs-tree #tree_sort_btn"),tree_data.enum_tree_type.card),$("#tree").disableSelection(),$("#tabs-note #tree_sort_btn").toolbar({content:"#note_tree_sort_toolbar",position:"bottom",style:"dark",animation:"flip",event:"click",hideOnClick:!0}),tree_sort_icon($("#tabs-note #tree_sort_btn"),tree_data.enum_tree_type.note),$("#note_tree").disableSelection()})),$(document).on("click","#tree_option #hidden_btn",(function(){tree_data.tree_hidden=!tree_data.tree_hidden;let e=$("#tree").fancytree("getTree");$(this).toggleClass("uncheck"),e.render(),select_controll(e)})),$(document).on("click","#tree_option #bookmark_list_btn",(function(){card_get_bookmark()})),$(document).on("click","#tree_option #tree_reload_btn",(function(){let e=$("#tree").fancytree("getTree"),t=$("#tree").fancytree("getTree").getFirstChild();tree_data.active_key=e.getActiveNode(),tree_data.select_key=e.getSelectedNodes()[0],tree_data.expand_list=[],tree_data.scroll_top=$("#"+e.rootNode.ul.id).scrollTop(),tree_refresh_target(e,t,tree_data.expand_list),$("#"+e.rootNode.ul.id).scrollTop(tree_data.scroll_top)})),$(document).on("click",".tool-container #title_asc_btn",(function(){$("#tabs-tree #tree_sort_btn").trigger("click"),localStorage.tree_sort_type=tree_data.type_sort_enum.title_asc,tree_sort_icon($("#tabs-tree #tree_sort_btn"),tree_data.enum_tree_type.card),node_sort($("#tree").fancytree("getTree").getFirstChild(),tree_data.type_sort_enum.title_asc)})),$(document).on("click",".tool-container #title_desc_btn",(function(){$("#tabs-tree #tree_sort_btn").trigger("click"),localStorage.tree_sort_type=tree_data.type_sort_enum.title_desc,tree_sort_icon($("#tabs-tree #tree_sort_btn"),tree_data.enum_tree_type.card),node_sort($("#tree").fancytree("getTree").getFirstChild(),tree_data.type_sort_enum.title_desc)})),$(document).on("click",".tool-container #utime_asc_btn",(function(){$("#tabs-tree #tree_sort_btn").trigger("click"),localStorage.tree_sort_type=tree_data.type_sort_enum.utime_asc,tree_sort_icon($("#tabs-tree #tree_sort_btn"),tree_data.enum_tree_type.card),node_sort($("#tree").fancytree("getTree").getFirstChild(),tree_data.type_sort_enum.utime_asc)})),$(document).on("click",".tool-container #utime_desc_btn",(function(){$("#tabs-tree #tree_sort_btn").trigger("click"),localStorage.tree_sort_type=tree_data.type_sort_enum.utime_desc,tree_sort_icon($("#tabs-tree #tree_sort_btn"),tree_data.enum_tree_type.card),node_sort($("#tree").fancytree("getTree").getFirstChild(),tree_data.type_sort_enum.utime_desc)}));let glyph_opts={preset:"awesome5",map:{checkbox:"far fa-square fa-lg",checkboxSelected:"far fa-check-square fa-lg",checkboxUnknown:"far fa-minus-square fa-lg",expanderClosed:"fas fa-angle-right fa-lg",expanderLazy:"fas fa-angle-right fa-lg",expanderOpen:"fas fa-caret-down fa-lg"}},wide_opts={iconWidth:"0.5em",iconSpacing:"0.5em",labelSpacing:"1.1em",levelOfs:"1.5em"};function set_card_node_menu_disabled(e,t=!0){e.create.disabled=t,e.title.disabled=t,e.state.disabled=t,e.priority.disabled=t,e.hide.disabled=t,e.lock.disabled=t,e.batch.disabled=t,e.move.disabled=t,e.delete.disabled=t,e.remove.disabled=t,e.recover.disabled=t}function render_node_menu(e,t){switch(1==e.data.is_lock?(t.lock.icon="fas fa-lock fa-fw text-gold",t.lock.name=i18next.t("tree:tree.drop.unlock")):(t.lock.icon="fas fa-unlock fa-fw text-dark",t.lock.name=i18next.t("tree:tree.drop.lock")),1==e.data.is_hidden?(t.hide.icon="fas fa-eye fa-fw text-dark",t.hide.name=i18next.t("tree:tree.drop.show")):(t.hide.icon="fas fa-eye-slash fa-fw text-dark",t.hide.name=i18next.t("tree:tree.drop.hide")),e.data.priority){case card_detail.type_priority_enum.urgent:t.priority.icon="fas fa-angle-double-up fa-fw text-danger";break;case card_detail.type_priority_enum.high:t.priority.icon="fas fa-angle-up fa-fw text-warning";break;case card_detail.type_priority_enum.medium:t.priority.icon="fas fa-minus fa-fw text-primary";break;case card_detail.type_priority_enum.low:t.priority.icon="fas fa-angle-down fa-fw text-dark";break;case card_detail.type_priority_enum.lowest:t.priority.icon="fas fa-angle-double-down fa-fw text-light";break;default:t.priority.icon="fas fa-minus fa-fw text-primary"}switch(e.data.status){case tree_data.enum_card_status.ready:t.state.icon="far fa-circle fa-fw text-dark";break;case tree_data.enum_card_status.progress:t.state.icon="far fa-play-circle fa-fw text-primary";break;case tree_data.enum_card_status.stop:t.state.icon="far fa-pause-circle fa-fw text-warning";break;case tree_data.enum_card_status.cancel:t.state.icon="far fa-stop-circle fa-fw text-danger";break;case tree_data.enum_card_status.complete:t.state.icon="far fa-check-circle fa-fw text-success";break;default:t.state.icon="far fa-play-circle fa-fw text-primary"}set_card_node_menu_disabled(t,!1),e.data.tree_type==tree_data.enum_tree_type.card?1==e.isTopLevel()?1==e.data.is_owner?(t.title.disabled=!0,t.hide.disabled=!0,t.lock.disabled=!0,t.move.disabled=!0,t.delete.disabled=!0,t.remove.disabled=!0,t.recover.disabled=!0):set_card_node_menu_disabled(t,!0):1==e.data.is_owner||e.data.tree_type==tree_data.enum_tree_type.note?1==e.data.is_deleted?(set_card_node_menu_disabled(t,!0),t.remove.disabled=!1,t.recover.disabled=!1):1==e.data.is_lock&&(set_card_node_menu_disabled(t,!0),t.lock.disabled=!1):set_card_node_menu_disabled(t,!0):1==e.isTopLevel()?(t.title.disabled=!0,t.hide.disabled=!0,t.lock.disabled=!0,t.move.disabled=!0,t.delete.disabled=!0,t.remove.disabled=!0,t.recover.disabled=!0):1==e.data.is_deleted?(set_card_node_menu_disabled(t,!0),t.remove.disabled=!1,t.recover.disabled=!1):1==e.data.is_lock&&(set_card_node_menu_disabled(t,!0),t.lock.disabled=!1),1==e.data.is_deleted?(t.delete.visible=!1,t.remove.visible=!0,t.recover.visible=!0):(t.delete.visible=!0,t.remove.visible=!1,t.recover.visible=!1),1==e.hasChildren()?t.batch.visible=!0:t.batch.visible=!1,e.data.tree_type==tree_data.enum_tree_type.note&&(t.hide.visible=!1,t.lock.visible=!1,t.priority.visible=!1,1==e.hasChildren()?t.batch.visible=!0:t.batch.visible=!1)}function node_menu_action(e,t){const a=t.key;switch(e){case"create":t.data.tree_type==tree_data.enum_tree_type.card&&($("#card_create_modal #contents_title_area h3").attr("data-i18n","modal:title.card create"),$("#card_create_modal #create_card_input").attr("data-i18n","[placeholder]modal:input.card title"),$("#card_create_modal").data("tree_type",t.data.tree_type)),t.data.tree_type==tree_data.enum_tree_type.note&&($("#card_create_modal #contents_title_area h3").attr("data-i18n","modal:title.note create"),$("#card_create_modal #create_card_input").attr("data-i18n","[placeholder]modal:input.note title"),$("#card_create_modal").data("tree_type",t.data.tree_type)),$("#card_create_modal #create_card_btn").data("card_seq",a),$("#card_create_modal #create_card_close_btn").data("card_seq",a),$("#card_create_modal #create_card_input").data("card_seq",a),$("#create_card_input").val(""),$("#card_create_modal").modal();break;case"title":t.data.tree_type==tree_data.enum_tree_type.card&&($("#card_title_modal #contents_title_area h3").attr("data-i18n","modal:title.card rename"),$("#card_title_modal #title_card_input").attr("data-i18n","[placeholder]modal:input.card title"),$("#card_title_modal").data("tree_type",t.data.tree_type)),t.data.tree_type==tree_data.enum_tree_type.note&&($("#card_title_modal #contents_title_area h3").attr("data-i18n","modal:title.note rename"),$("#card_title_modal #title_card_input").attr("data-i18n","[placeholder]modal:input.note title"),$("#card_title_modal").data("tree_type",t.data.tree_type)),$("#card_title_modal #title_card_btn").data("card_seq",a),$("#card_title_modal #title_card_close_btn").data("card_seq",a),$("#card_title_modal #title_card_input").data("card_seq",a),$("#title_card_input").val(t.title),$("#card_title_modal").modal();break;case"state_ready":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_status(card_detail.type_status_enum.ready,a),t.data.tree_type==tree_data.enum_tree_type.note&&note_set_status(card_detail.type_status_enum.ready,a);break;case"state_progress":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_status(card_detail.type_status_enum.progress,a),t.data.tree_type==tree_data.enum_tree_type.note&&note_set_status(card_detail.type_status_enum.progress,a);break;case"state_stop":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_status(card_detail.type_status_enum.stop,a),t.data.tree_type==tree_data.enum_tree_type.note&&note_set_status(card_detail.type_status_enum.stop,a);break;case"state_cancel":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_status(card_detail.type_status_enum.cancel,a),t.data.tree_type==tree_data.enum_tree_type.note&&note_set_status(card_detail.type_status_enum.cancel,a);break;case"state_complete":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_status(card_detail.type_status_enum.complete,a),t.data.tree_type==tree_data.enum_tree_type.note&&note_set_status(card_detail.type_status_enum.complete,a);break;case"priority_urgent":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_priority(card_detail.type_priority_enum.urgent,a);break;case"priority_high":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_priority(card_detail.type_priority_enum.high,a);break;case"priority_medium":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_priority(card_detail.type_priority_enum.medium,a);break;case"priority_low":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_priority(card_detail.type_priority_enum.low,a);break;case"priority_lowest":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_priority(card_detail.type_priority_enum.lowest,a);break;case"hide":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_hidden(a,t.data.is_hidden);break;case"lock":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_lock(a,!t.data.is_lock);break;case"attribute_batch":t.data.tree_type==tree_data.enum_tree_type.card&&($("#card_state_batch_select_modal").data("tree_type",tree_data.enum_tree_type.card),v_card_duplication_tree($("#tree"),$("#batch_tree"),t)),t.data.tree_type==tree_data.enum_tree_type.note&&($("#card_state_batch_select_modal").data("tree_type",tree_data.enum_tree_type.note),v_card_duplication_tree($("#note_tree"),$("#batch_tree"),t)),$("#card_state_batch_modal #card_state_batch_btn").attr("disabled",!0),$("#card_state_batch_modal #all_select i").removeClass("fa-check-square"),$("#card_state_batch_modal #all_select i").removeClass("fa-square"),$("#card_state_batch_modal #all_select i").addClass("fa-square"),$("#card_state_batch_modal").modal(),$("#batch_tree").fancytree("getTree").visit((function(e){e.setExpanded(!0)}));break;case"move_batch":{t.data.tree_type==tree_data.enum_tree_type.card&&($("#card_move_modal").data("tree_type",tree_data.enum_tree_type.card),v_card_duplication_tree($("#tree"),$("#move_tree"))),t.data.tree_type==tree_data.enum_tree_type.note&&($("#card_move_modal").data("tree_type",tree_data.enum_tree_type.note),v_card_duplication_tree($("#note_tree"),$("#move_tree"))),$("#card_move_modal #card_move_btn").data("seq",a);const e=t.getChildren();v_under_list($("#card_move_batch_modal"),e),$("#card_move_batch_modal #card_move_batch_btn").attr("disabled",!0),$("#card_move_batch_modal").modal();break}case"move":t.data.tree_type==tree_data.enum_tree_type.card&&($("#card_move_modal").data("tree_type",tree_data.enum_tree_type.card),v_card_duplication_tree($("#tree"),$("#move_tree"))),t.data.tree_type==tree_data.enum_tree_type.note&&($("#card_move_modal").data("tree_type",tree_data.enum_tree_type.note),v_card_duplication_tree($("#note_tree"),$("#move_tree"))),$("#card_move_modal #card_move_btn").data("seq",a),$("#card_move_modal").modal();break;case"delete":case"remove":t.data.tree_type==tree_data.enum_tree_type.card&&card_del_remove(a),t.data.tree_type==tree_data.enum_tree_type.note&&note_del_remove(a);break;case"recover":t.data.tree_type==tree_data.enum_tree_type.card&&card_set_recover(a),t.data.tree_type==tree_data.enum_tree_type.note&&note_set_recover(a)}}$("#tree").fancytree({extensions:["glyph","wide","contextMenu"],icon:!1,toggleEffect:!1,clickFolderMode:1,selectMode:1,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,quicksearch:!0,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 카드들이 없습니다.",key:0}]},lazyLoad:function(e,t){$.ajax({url:"/get_card_tree",method:"POST",async:!1,data:{space_seq:space_seq,card_seq:t.node.key,target_account_seq:account_list.enum_account_self.self},success:function(e){if(0==e.ec){let a=make_map(e.info,"card_seq","pcard_seq"),r=make_tree(e.info,a,0);if(null==r.key)return t.result=r.children,t.node.title="접근 가능한 카드들이 없습니다.",t.node.key="0",t.node.renderTitle(r.title),tree_rendering(t.node),t.node.lazy=!1,void $("#overload").remove();t.result=r.children,t.node.data.type_member=r.type_member,t.node.data.is_owner=r.is_owner,t.node.data.is_hidden=r.is_hidden,t.node.data.is_editable=r.is_editable,t.node.data.is_deleted=r.is_deleted,t.node.data.is_todo=r.is_todo,t.node.data.is_lock=r.is_lock,t.node.data.status=r.status,t.node.data.card_sort_seq=r.card_sort_seq,t.node.data.per_done=r.per_done,t.node.data.priority=r.priority,t.node.data.tree_type=r.tree_type,t.node.title=r.title,t.node.key=r.key.toString(),t.node.renderTitle(r.title),tree_rendering(t.node),t.node.lazy=!1,$("#overload").remove()}else cs_msg.noti_err(t.ec)},dataType:"json"})},contextMenu:{menu:{create:{name:()=>i18next.t("tree:tree.drop.create"),icon:"fas fa-plus fa-fw text-dark"},title:{name:()=>i18next.t("tree:tree.drop.title"),icon:"fas fa-edit fa-fw text-dark"},sep1:"---------",state:{name:()=>i18next.t("tree:tree.drop.state.name"),icon:"far fa-circle fa-fw text-dark",items:{state_ready:{name:()=>i18next.t("tree:tree.drop.state.ready"),icon:"far fa-circle fa-fw text-dark"},state_progress:{name:()=>i18next.t("tree:tree.drop.state.progress"),icon:"far fa-play-circle fa-fw text-primary"},state_stop:{name:()=>i18next.t("tree:tree.drop.state.stop"),icon:"far fa-pause-circle fa-fw text-warning"},state_cancel:{name:()=>i18next.t("tree:tree.drop.state.cancel"),icon:"far fa-stop-circle fa-fw text-danger"},state_complete:{name:()=>i18next.t("tree:tree.drop.state.complete"),icon:"far fa-check-circle fa-fw text-success"}}},priority:{name:()=>i18next.t("tree:tree.drop.priority.name"),icon:"fas fa-minus fa-fw text-primary",items:{priority_urgent:{name:()=>i18next.t("tree:tree.drop.priority.urgent"),icon:"fas fa-angle-double-up fa-fw text-danger"},priority_high:{name:()=>i18next.t("tree:tree.drop.priority.high"),icon:"fas fa-angle-up fa-fw text-warning"},priority_medium:{name:()=>i18next.t("tree:tree.drop.priority.medium"),icon:"fas fa-minus fa-fw text-primary"},priority_low:{name:()=>i18next.t("tree:tree.drop.priority.low"),icon:"fas fa-angle-down fa-fw text-dark"},priority_lowest:{name:()=>i18next.t("tree:tree.drop.priority.lowest"),icon:"fas fa-angle-double-down fa-fw text-light"}}},sep2:"---------",hide:{name:()=>i18next.t("tree:tree.drop.hide"),icon:"fas fa-eye-slash fa-fw text-dark"},lock:{name:()=>i18next.t("tree:tree.drop.lock"),icon:"fas fa-unlock fa-fw text-dark"},sep3:"---------",batch:{name:()=>i18next.t("tree:tree.drop.under"),icon:"fas fa-level-down-alt fa-fw text-dark",items:{attribute_batch:{name:()=>i18next.t("tree:tree.drop.attribute batch"),icon:"fas fa-play fa-fw text-dark"},move_batch:{name:()=>i18next.t("tree:tree.drop.move batch"),icon:"far fa-share-square fa-fw text-dark"}}},move:{name:()=>i18next.t("tree:tree.drop.move"),icon:"far fa-share-square fa-fw text-dark"},delete:{name:()=>i18next.t("tree:tree.drop.delete"),icon:"fas fa-trash fa-fw text-dark"},remove:{name:()=>i18next.t("tree:tree.drop.remove"),icon:"fas fa-trash fa-fw text-dark",visible:!1},recover:{name:()=>i18next.t("tree:tree.drop.recover"),icon:"fas fa-reply fa-fw text-dark",visible:!1}},actions:function(e,t,a){node_menu_action(t,e)}},loadChildren:function(e,t){let a=$("#tree").fancytree("getTree");if(null!=a.getFirstChild()&&a.getFirstChild().setExpanded(!0,{noAnimation:!0,noEvents:!0}),tree_data.expand_list.forEach((function(e){let t=a.getNodeByKey(e);null!=t&&t.setExpanded(!0,{noAnimation:!0,noEvents:!0})})),null!=tree_data.select_key){let e=a.getNodeByKey(tree_data.select_key.key);null!=e&&(e.getParentList().forEach((function(e){e.setExpanded(!0,{noAnimation:!0,noEvents:!0})})),e.setSelected())}if(null!=tree_data.active_key){let e=a.getNodeByKey(tree_data.active_key.key);null!=e&&e.setActive()}$("#"+a.rootNode.ul.id).scrollTop(tree_data.scroll_top),node_sort(t.node,localStorage.tree_sort_type),1==init.is_query&&0!=a.getFirstChild().key&&(null!=url("?q")?url_history(JSON.parse(decodeURIComponent(atob(url("?q"))))):set_history(),init.is_query=!1)},collapse:function(e,t){t.node.visit((function(e){e.setExpanded(!1)}),!0)},postProcess:function(e,t){null!=t&&0!=Array.isArray(t.response)&&t.response[0]},renderNode:function(e,t){tree_rendering(t.node)},activate:function(e,t){},click:function(e,t){if("expander"==t.targetType||!t.targetType)return;let a=$("#tree").fancytree("getTree");if(init.is_web){if(!a.getSelectedNodes()[0])return void list_node_click(t.node,!0);a.getSelectedNodes()[0].key==t.node.key?(t.node.isExpanded()?t.node.setExpanded(!1):t.node.setExpanded(!0),list_node_click(t.node,!0)):list_node_click(t.node,!0)}else{if(!a.getActiveNode())return void t.node.setActive();a.getActiveNode().key==t.node.key?list_node_click(t.node,!0):t.node.setActive()}},keydown:function(e,t){if(13===e.which)return card_detail.card_seq==t.node.key?void(t.node.isExpanded()?t.node.setExpanded(!1,{noAnimation:!0,noEvents:!0}):t.node.setExpanded(!0,{noAnimation:!0,noEvents:!0})):(list_node_click(t.node,!0),!1)}}),$("#note_tree").fancytree({extensions:["glyph","wide","contextMenu"],icon:!1,toggleEffect:!1,clickFolderMode:1,selectMode:1,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,quicksearch:!0,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 노트들이 없습니다.",key:0}]},lazyLoad:function(e,t){$.ajax({url:"/note_get_note_tree",method:"POST",async:!1,data:{space_seq:space_seq,note_seq:t.node.key,target_account_seq:account_list.enum_account_self.self},success:function(e){if(0==e.ec){let a=make_map(e.info,"note_seq","pnote_seq"),r=make_note_tree(e.info,a,0);if(null==r.key)return t.result=r.children,t.node.title="접근 가능한 노트들이 없습니다.",t.node.key="0",t.node.renderTitle(r.title),tree_rendering(t.node,!0),t.node.lazy=!1,void $("#overload").remove();t.result=r.children,t.node.data.is_deleted=r.is_deleted,t.node.data.status=r.status,t.node.data.card_sort_seq=r.utime_seq,t.node.data.tree_type=r.tree_type,t.node.title=r.title,t.node.key=r.key.toString(),t.node.renderTitle(r.title),tree_rendering(t.node,!0),t.node.lazy=!1}else cs_msg.noti_err(e.ec)},dataType:"json"})},contextMenu:{menu:{create:{name:()=>i18next.t("tree:tree.drop.create"),icon:"fas fa-plus fa-fw text-dark"},title:{name:()=>i18next.t("tree:tree.drop.title"),icon:"fas fa-edit fa-fw text-dark"},sep1:"---------",state:{name:()=>i18next.t("tree:tree.drop.state.name"),icon:"far fa-circle fa-fw text-dark",items:{state_ready:{name:()=>i18next.t("tree:tree.drop.state.ready"),icon:"far fa-circle fa-fw text-dark"},state_progress:{name:()=>i18next.t("tree:tree.drop.state.progress"),icon:"far fa-play-circle fa-fw text-primary"},state_stop:{name:()=>i18next.t("tree:tree.drop.state.stop"),icon:"far fa-pause-circle fa-fw text-warning"},state_cancel:{name:()=>i18next.t("tree:tree.drop.state.cancel"),icon:"far fa-stop-circle fa-fw text-danger"},state_complete:{name:()=>i18next.t("tree:tree.drop.state.complete"),icon:"far fa-check-circle fa-fw text-success"}}},priority:{name:()=>i18next.t("tree:tree.drop.priority.name"),icon:"fas fa-minus fa-fw text-primary",items:{priority_urgent:{name:()=>i18next.t("tree:tree.drop.priority.urgent"),icon:"fas fa-angle-double-up fa-fw text-danger"},priority_high:{name:()=>i18next.t("tree:tree.drop.priority.high"),icon:"fas fa-angle-up fa-fw text-warning"},priority_medium:{name:()=>i18next.t("tree:tree.drop.priority.medium"),icon:"fas fa-minus fa-fw text-primary"},priority_low:{name:()=>i18next.t("tree:tree.drop.priority.low"),icon:"fas fa-angle-down fa-fw text-dark"},priority_lowest:{name:()=>i18next.t("tree:tree.drop.priority.lowest"),icon:"fas fa-angle-double-down fa-fw text-light"}}},sep2:"---------",hide:{name:()=>i18next.t("tree:tree.drop.hide"),icon:"fas fa-eye-slash fa-fw text-dark"},lock:{name:()=>i18next.t("tree:tree.drop.lock"),icon:"fas fa-unlock fa-fw text-dark"},batch:{name:()=>i18next.t("tree:tree.drop.under"),icon:"fas fa-level-down-alt fa-fw text-dark",items:{attribute_batch:{name:()=>i18next.t("tree:tree.drop.attribute batch"),icon:"fas fa-play fa-fw text-dark"},move_batch:{name:()=>i18next.t("tree:tree.drop.move batch"),icon:"far fa-share-square fa-fw text-dark"}}},move:{name:()=>i18next.t("tree:tree.drop.move"),icon:"far fa-share-square fa-fw text-dark"},delete:{name:()=>i18next.t("tree:tree.drop.delete"),icon:"fas fa-trash fa-fw text-dark"},remove:{name:()=>i18next.t("tree:tree.drop.remove"),icon:"fas fa-trash fa-fw text-dark",visible:!1},recover:{name:()=>i18next.t("tree:tree.drop.recover"),icon:"fas fa-reply fa-fw text-dark",visible:!1}},actions:function(e,t,a){console.log(t,e.title,e),node_menu_action(t,e)}},loadChildren:function(e,t){let a=$("#note_tree").fancytree("getTree");if(null!=a.getFirstChild()&&a.getFirstChild().setExpanded(!0,{noAnimation:!0,noEvents:!0}),tree_data.note_expand_list.forEach((function(e){let t=a.getNodeByKey(e);null!=t&&t.setExpanded(!0,{noAnimation:!0,noEvents:!0})})),null!=tree_data.note_select_key){let e=a.getNodeByKey(tree_data.note_select_key.key);null!=e&&(e.getParentList().forEach((function(e){e.setExpanded(!0,{noAnimation:!0,noEvents:!0})})),e.setSelected())}if(null!=tree_data.note_active_key){let e=a.getNodeByKey(tree_data.note_active_key.key);null!=e&&e.setActive()}$("#"+a.rootNode.ul.id).scrollTop(tree_data.note_scroll_top),node_sort(t.node,localStorage.note_tree_sort_type)},collapse:function(e,t){t.node.visit((function(e){e.setExpanded(!1)}),!0)},postProcess:function(e,t){null!=t&&0!=Array.isArray(t.response)&&t.response[0]},renderNode:function(e,t){tree_rendering(t.node,!0)},click:function(e,t){if("expander"==t.targetType||!t.targetType)return;let a=$("#note_tree").fancytree("getTree");if(init.is_web){if(!a.getSelectedNodes()[0])return void note_node_click(t.node,!0);a.getSelectedNodes()[0].key==t.node.key?(t.node.isExpanded()?t.node.setExpanded(!1):t.node.setExpanded(!0),note_node_click(t.node,!0)):note_node_click(t.node,!0)}else{if(!a.getActiveNode())return void t.node.setActive();a.getActiveNode().key==t.node.key?note_node_click(t.node,!0):t.node.setActive()}},keydown:function(e,t){if(13===e.which)return card_detail.card_seq==t.node.key?void(t.node.isExpanded()?t.node.setExpanded(!1,{noAnimation:!0,noEvents:!0}):t.node.setExpanded(!0,{noAnimation:!0,noEvents:!0})):(note_node_click(t.node,!0),!1)}}),$("#batch_tree").fancytree({extensions:["glyph","wide"],icon:!1,toggleEffect:!1,clickFolderMode:1,selectMode:2,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,activeVisible:!1,clickFolderMode:4,activeVisible:!1,keyboard:!1,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 카드들이 없습니다.",key:0}]},collapse:function(e,t){t.node.visit((function(e){e.setExpanded(!1)}),!0)},renderNode:function(e,t){$(t.node.span.lastChild.children).remove(),tree_rendering(t.node),1==t.node.data.is_deleted&&$(t.node.li).addClass("hidden")},select:function(e,t){0==t.tree.getSelectedNodes().length?$("#card_state_batch_modal #card_state_batch_btn").attr("disabled",!0):$("#card_state_batch_modal #card_state_batch_btn").attr("disabled",!1),$("#card_state_batch_modal #batch_select_count").text(t.tree.getSelectedNodes().length+" / "+t.tree.count())},click:function(e,t){if("expander"==t.targetType)return;let a=!t.node.isSelected();t.node.setSelected(a,{noAnimation:!0,noEvents:!1})}}),$("#move_tree").fancytree({extensions:["glyph","wide"],icon:!1,toggleEffect:!1,clickFolderMode:1,selectMode:1,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,activeVisible:!1,clickFolderMode:4,keyboard:!0,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 카드들이 없습니다.",key:0}]},collapse:function(e,t){t.node.visit((function(e){e.setExpanded(!1)}),!0)},renderNode:function(e,t){$(t.node.span.lastChild.children).remove(),tree_rendering(t.node)},click:function(e,t){"expander"!=t.targetType&&(t.node.setActive(!0,{noAnimation:!0,noEvents:!0}),t.node.setSelected(!0,{noAnimation:!0,noEvents:!0}))},keydown:function(e,t){if(13===e.which)return t.node.setActive(!0,{noAnimation:!0,noEvents:!0}),t.node.setSelected(!0,{noAnimation:!0,noEvents:!0}),!1}}),$("#link_tree").fancytree({extensions:["glyph","wide"],icon:!1,toggleEffect:!1,clickFolderMode:1,selectMode:1,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,activeVisible:!1,clickFolderMode:4,keyboard:!0,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 카드들이 없습니다.",key:0}]},collapse:function(e,t){t.node.visit((function(e){e.setExpanded(!1)}),!0)},renderNode:function(e,t){$(t.node.span.lastChild.children).remove(),tree_rendering(t.node)},click:function(e,t){"expander"!=t.targetType&&(t.node.setActive(!0,{noAnimation:!0,noEvents:!0}),t.node.setSelected(!0,{noAnimation:!0,noEvents:!0}))},keydown:function(e,t){if(13===e.which)t.node.setActive(!0,{noAnimation:!0,noEvents:!0}),t.node.setSelected(!0,{noAnimation:!0,noEvents:!0})}}),$("#confirm_card_tree").fancytree({extensions:["glyph","wide"],icon:!1,toggleEffect:!1,selectMode:2,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,activeVisible:!1,keyboard:!0,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 카드들이 없습니다.",key:0}]},collapse:function(e,t){t.node.visit((function(e){e.setExpanded(!1)}),!0)},renderNode:function(e,t){$(t.node.span.lastChild.children).remove(),tree_rendering(t.node,!0)},click:function(e,t){"expander"!=t.targetType&&(t.node.setActive(!0,{noAnimation:!0,noEvents:!0}),1==t.node.selected?t.node.setSelected(!1,{noAnimation:!0,noEvents:!0}):t.node.setSelected(!0,{noAnimation:!0,noEvents:!0}))},keydown:function(e,t){if(13===e.which)t.node.setActive(!0,{noAnimation:!0,noEvents:!0}),1==t.node.selected?t.node.setSelected(!1,{noAnimation:!0,noEvents:!0}):t.node.setSelected(!0,{noAnimation:!0,noEvents:!0})}}),$("#org_tree").fancytree({extensions:["glyph","wide"],icon:!1,toggleEffect:!1,clickFolderMode:1,selectMode:3,checkbox:!0,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 카드들이 없습니다.",key:0}]},loadChildren:function(e,t){let a=$("#org_tree").fancytree("getTree");null!=a.getFirstChild()&&(a.getFirstChild().setExpanded(!0,{noAnimation:!0,noEvents:!0}),a.getFirstChild().setExpanded(!0,{noAnimation:!0,noEvents:!0})),org_data.org_expand_list.forEach((function(e){a.getRootNode().getChildren().forEach((function(t){if(t.key==e.pnode){let r=a.getNodeByKey(e.node,t);null!=r&&r.setExpanded(!0,{noAnimation:!0,noEvents:!0})}}))})),null!=org_data.org_active_key&&a.getRootNode().getChildren().forEach((function(e){e.key==org_data.org_active_key.pnode&&e.visit((function(e){if(e.parent.key==org_data.org_active_pkey&&e.key==org_data.org_active_key.node)return e.setActive(),!1}),!0)})),$("#"+a.rootNode.ul.id).scrollTop(org_data.org_scroll_top)},collapse:function(e,t){t.node.visit((function(e){e.setExpanded(!1)}),!0)},postProcess:function(e,t){null!=t&&0!=Array.isArray(t.response)&&t.response[0]},renderNode:function(e,t){if($(t.node.span.lastChild).addClass("fancytree-normal"),!0===t.node.hasChildren()){let e=parseInt($(".ui-fancytree > li > ul").css("padding-left")),a=e*t.node.getLevel(),r=e*(t.node.getLevel()-1);$(".fancytree-expander",t.node.span).css("right",a),$(".fancytree-expander",t.node.span).css("padding-left",a),$(".fancytree-checkbox",t.node.span).css("right",r)}$(t.node.span.lastChild.children).remove(),$(t.node.li).removeClass(),t.node.folder?$(t.node.span.lastChild).prepend('<span class="fas fa-users org_icon text-dark"></span>'):null!=t.node.data.url&&$(t.node.span.lastChild).prepend(`<img class="img-circle org_photo org_icon" src="${t.node.data.url}">`)},click:function(e,t){if("expander"==t.targetType||!t.targetType)return;"checkbox"==t.targetType&&e.preventDefault(),0==org_data.is_web?org_data.org_split.collapse(0):org_data.org_split.setSizes([40,60]);let a=!t.node.selected,r=new Array;if(1==t.node.folder){let e=new Array;t.node.setSelected(a),t.node.visit((function(t){1==t.data.is_account&&-1==e.indexOf(t.data.account_seq)&&e.push(t.data.account_seq)})),t.tree.visit((function(t){0==t.folder&&e.indexOf(t.data.account_seq)>=0&&t.setSelected(a)}))}else t.tree.visit((function(e){e.data.account_seq==t.node.data.account_seq&&e.setSelected(a)}));t.tree.getSelectedNodes().forEach((function(e){1==e.data.is_account&&-1==r.indexOf(e.data.account_seq)&&r.push(e.data.account_seq)})),t.tree.visit((function(e){0==e.folder&&1==e.data.is_account&&r.indexOf(e.data.account_seq)>=0&&e.setSelected(!0)})),set_org_account_breadcrumb(r,$("#org_info"))},keydown:function(e,t){if(13===e.which)$(t.node.span).trigger("click")}}),$("#org_mgt_tree").fancytree({extensions:["glyph","wide"],icon:!1,toggleEffect:!1,clickFolderMode:1,selectMode:3,checkbox:!0,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 카드들이 없습니다.",key:0}]},loadChildren:function(e,t){let a=$("#org_mgt_tree").fancytree("getTree");null!=a.getFirstChild()&&a.getFirstChild().setExpanded(!0,{noAnimation:!0,noEvents:!0}),org_data.org_expand_list.forEach((function(e){a.getRootNode().getChildren().forEach((function(t){if(t.key==e.pnode){let r=a.getNodeByKey(e.node,t);null!=r&&r.setExpanded(!0,{noAnimation:!0,noEvents:!0})}}))})),null!=org_data.org_active_key&&a.getRootNode().getChildren().forEach((function(e){e.key==org_data.org_active_key.pnode&&e.visit((function(e){if(e.parent.key==org_data.org_active_pkey&&e.key==org_data.org_active_key.node)return e.setActive(),!1}),!0)})),$("#"+a.rootNode.ul.id).scrollTop(org_data.org_scroll_top)},collapse:function(e,t){t.node.visit((function(e){e.setExpanded(!1)}),!0)},postProcess:function(e,t){null!=t&&0!=Array.isArray(t.response)&&t.response[0]},renderNode:function(e,t){if($(t.node.span.lastChild).addClass("fancytree-normal"),!0===t.node.hasChildren()){let e=parseInt($(".ui-fancytree > li > ul").css("padding-left")),a=e*t.node.getLevel(),r=e*(t.node.getLevel()-1);$(".fancytree-expander",t.node.span).css("right",a),$(".fancytree-expander",t.node.span).css("padding-left",a),$(".fancytree-checkbox",t.node.span).css("right",r)}$(t.node.span.lastChild.children).remove(),$(t.node.li).removeClass(),t.node.folder?$(t.node.span.lastChild).prepend('<span class="fas fa-users org_icon text-dark"></span>'):null!=t.node.data.url&&$(t.node.span.lastChild).prepend(`<img class="img-circle org_photo org_icon" src="${t.node.data.url}">`)},click:function(e,t){if("expander"==t.targetType||!t.targetType)return;"checkbox"==t.targetType&&e.preventDefault(),0==org_data.is_web?org_data.org_mgt_split.collapse(0):org_data.org_mgt_split.setSizes([40,60]);let a=!t.node.selected,r=new Array;if(1==t.node.folder){let e=new Array;t.node.setSelected(a),t.node.visit((function(t){1==t.data.is_account&&-1==e.indexOf(t.data.account_seq)&&e.push(t.data.account_seq)})),t.tree.visit((function(t){0==t.folder&&e.indexOf(t.data.account_seq)>=0&&t.setSelected(a)}))}else t.tree.visit((function(e){e.data.account_seq==t.node.data.account_seq&&e.setSelected(a)}));t.tree.getSelectedNodes().forEach((function(e){1==e.data.is_account&&-1==r.indexOf(e.data.account_seq)&&r.push(e.data.account_seq)})),t.tree.visit((function(e){0==e.folder&&1==e.data.is_account&&r.indexOf(e.data.account_seq)>=0&&e.setSelected(!0)})),set_org_account_breadcrumb(r,$("#org_mgt_info"))},keydown:function(e,t){if(13===e.which)$(t.node.span).trigger("click")}}),$("#org_member_tree").fancytree({extensions:["glyph","wide"],icon:!1,toggleEffect:!1,clickFolderMode:1,selectMode:1,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 카드들이 없습니다.",key:0}]},postProcess:function(e,t){null!=t&&0!=Array.isArray(t.response)&&t.response[0]},renderNode:function(e,t){if($(t.node.span.lastChild).addClass("fancytree-normal"),!0===t.node.hasChildren()){let e=parseInt($(".ui-fancytree > li > ul").css("padding-left")),a=e*t.node.getLevel(),r=e*(t.node.getLevel()-1);$(".fancytree-expander",t.node.span).css("right",a),$(".fancytree-expander",t.node.span).css("padding-left",a),$(".fancytree-checkbox",t.node.span).css("right",r)}$(t.node.span.lastChild.children).remove(),$(t.node.li).removeClass(),t.node.folder?$(t.node.span.lastChild).prepend('<span class="fas fa-users org_icon text-dark"></span>'):null!=t.node.data.url&&$(t.node.span.lastChild).prepend(`<img class="img-circle org_photo org_icon" src="${t.node.data.url}">`)},click:function(e,t){"expander"!=t.targetType&&t.targetType&&(0==org_data.is_web?org_data.org_member_split.collapse(0):org_data.org_member_split.setSizes([40,60]),1==t.node.data.is_account?account_get_profile_space(t.node.data.account_seq,v_org_member_profile):($("#org_member_detail >").remove(),$("#org_member_detail").append(`<h3>${t.node.title}</h3>`)))},keydown:function(e,t){if(13===e.which)$(t.node.span).trigger("click")}}),$(".select_modal #single_select_tree").fancytree({extensions:["glyph","wide"],icon:!1,toggleEffect:!1,clickFolderMode:1,selectMode:3,checkbox:!0,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 카드들이 없습니다.",key:0}]},loadChildren:function(e,t){let a=$(".select_modal #single_select_tree").fancytree("getTree");null!=a.getFirstChild()&&a.getFirstChild().setExpanded(!0,{noAnimation:!0,noEvents:!0})},collapse:function(e,t){t.node.visit((function(e){e.setExpanded(!1)}),!0)},postProcess:function(e,t){null!=t&&0!=Array.isArray(t.response)&&t.response[0]},renderNode:function(e,t){if($(t.node.span.lastChild).addClass("fancytree-normal"),!0===t.node.hasChildren()){let e=parseInt($(".ui-fancytree > li > ul").css("padding-left")),a=e*t.node.getLevel(),r=e*(t.node.getLevel()-1);$(".fancytree-expander",t.node.span).css("right",a),$(".fancytree-expander",t.node.span).css("padding-left",a),$(".fancytree-checkbox",t.node.span).css("right",r)}$(t.node.span.lastChild.children).remove(),$(t.node.li).removeClass(),t.node.folder?$(t.node.span.lastChild).prepend('<span class="fas fa-users org_icon text-dark"></span>'):null!=t.node.data.url&&$(t.node.span.lastChild).prepend(`<img class="img-circle org_photo org_icon" src="${t.node.data.url}">`)},click:function(e,t){if("expander"==t.targetType||!t.targetType||1==t.node.unselectable)return;"checkbox"==t.targetType&&e.preventDefault();let a=!t.node.selected,r=new Array;t.tree.visit((function(e){e.setSelected(!1),t.node.data.account_seq==e.data.account_seq&&e.setSelected(a)})),t.tree.getSelectedNodes().forEach((function(e){1==e.data.is_account&&-1==r.indexOf(e.data.account_seq)&&r.push(e.data.account_seq)})),v_account_select_list($("#single_select_modal #single_select_list"),r)},keydown:function(e,t){if(13===e.which)$(".fancytree-title",t.node.li).trigger("click")}}),$(".select_modal #multi_select_tree").fancytree({extensions:["glyph","wide"],icon:!1,toggleEffect:!1,clickFolderMode:1,selectMode:3,checkbox:!0,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 카드들이 없습니다.",key:0}]},loadChildren:function(e,t){let a=$("#org_mgt_tree").fancytree("getTree");null!=a.getFirstChild()&&a.getFirstChild().setExpanded(!0,{noAnimation:!0,noEvents:!0}),org_data.org_expand_list.forEach((function(e){a.getRootNode().getChildren().forEach((function(t){if(t.key==e.pnode){let r=a.getNodeByKey(e.node,t);null!=r&&r.setExpanded(!0,{noAnimation:!0,noEvents:!0})}}))})),null!=org_data.org_active_key&&a.getRootNode().getChildren().forEach((function(e){e.key==org_data.org_active_key.pnode&&e.visit((function(e){if(e.parent.key==org_data.org_active_pkey&&e.key==org_data.org_active_key.node)return e.setActive(),!1}),!0)})),$("#"+a.rootNode.ul.id).scrollTop(org_data.org_scroll_top)},collapse:function(e,t){t.node.visit((function(e){e.setExpanded(!1)}),!0)},postProcess:function(e,t){null!=t&&0!=Array.isArray(t.response)&&t.response[0]},renderNode:function(e,t){if($(t.node.span.lastChild).addClass("fancytree-normal"),!0===t.node.hasChildren()){let e=parseInt($(".ui-fancytree > li > ul").css("padding-left")),a=e*t.node.getLevel(),r=e*(t.node.getLevel()-1);$(".fancytree-expander",t.node.span).css("right",a),$(".fancytree-expander",t.node.span).css("padding-left",a),$(".fancytree-checkbox",t.node.span).css("right",r)}$(t.node.span.lastChild.children).remove(),$(t.node.li).removeClass(),t.node.folder?$(t.node.span.lastChild).prepend('<span class="fas fa-users org_icon text-dark"></span>'):null!=t.node.data.url&&$(t.node.span.lastChild).prepend(`<img class="img-circle org_photo org_icon" src="${t.node.data.url}">`)},click:function(e,t){if("expander"==t.targetType||!t.targetType)return;"checkbox"==t.targetType&&e.preventDefault();let a=!t.node.selected,r=new Array;if(1==t.node.folder){let e=new Array;t.node.setSelected(a),t.node.visit((function(t){1==t.data.is_account&&-1==e.indexOf(t.data.account_seq)&&e.push(t.data.account_seq)})),t.tree.visit((function(t){0==t.folder&&e.indexOf(t.data.account_seq)>=0&&t.setSelected(a)}))}else t.tree.visit((function(e){e.data.account_seq==t.node.data.account_seq&&e.setSelected(a)}));t.tree.getSelectedNodes().forEach((function(e){1==e.data.is_account&&-1==r.indexOf(e.data.account_seq)&&r.push(e.data.account_seq)})),t.tree.visit((function(e){0==e.folder&&1==e.data.is_account&&r.indexOf(e.data.account_seq)>=0&&e.setSelected(!0)})),v_account_select_list($("#multi_select_modal #multi_select_list"),r)},keydown:function(e,t){if(13===e.which)$(".fancytree-title",t.node.li).trigger("click")}}),$("#morg_move_tree").fancytree({extensions:["glyph","wide"],icon:!1,toggleEffect:!1,clickFolderMode:1,selectMode:1,autoCollapse:!1,autoScroll:!0,debugLevel:2,tooltip:!0,strings:{loading:""},glyph:glyph_opts,wide:wide_opts,source:function(){return[{title:"접근 가능한 카드들이 없습니다.",key:0}]},collapse:function(e,t){t.node.visit((function(e){e.setExpanded(!1)}),!0)},expand:function(e,t){},postProcess:function(e,t){null!=t&&0!=Array.isArray(t.response)&&t.response[0]},renderNode:function(e,t){if($(t.node.span.lastChild).addClass("fancytree-normal"),!0===t.node.hasChildren()){let e=parseInt($("#morg_tree .ui-fancytree > li > ul").css("padding-left"))*t.node.getLevel();$(".fancytree-expander",t.node.span).css("right",e),$(".fancytree-expander",t.node.span).css("padding-left",e)}else $(t.node.span.firstChild).css("width",0);$(t.node.span.lastChild.children).remove(),$(".fa-star",t.node.span).remove(),$(t.node.li).removeClass(),1==t.node.data.url&&$(t.node.span.lastChild).prepend(`<img class="img-circle org_photo org_icon" src="${t.node.data.url}">`),t.node.data.is_admin&&$(t.node.span).prepend('<span class="fas fa-star text-info"></span>')},activate:function(e,t){t.node.data.is_account?$("#morg_move_modal #morg_move_btn").attr("disabled",!0):$("#morg_move_modal #morg_move_btn").attr("disabled",!1)},click:function(e,t){},keydown:function(e,t){}}),$("#tree .ui-fancytree").scroll((function(){card_title_resize($("#tree"),init.tree_scroll_left,!1)})),$("#note_tree .ui-fancytree").scroll((function(){card_title_resize($("#note_tree"),init.note_tree_scroll_left,!1)})),$("#move_tree .ui-fancytree").scroll((function(){card_title_resize($("#move_tree"),init.move_tree_scroll_left,!1)})),$("#batch_tree .ui-fancytree").scroll((function(){card_title_resize($("#batch_tree"),init.batch_tree_scroll_left,!1)})),$("#link_tree .ui-fancytree").scroll((function(){card_title_resize($("#link_tree"),init.move_tree_scroll_left,!1)})),$("#org_tree .ui-fancytree").scroll((function(){card_title_resize($("#org_tree"),init.move_tree_scroll_left,!1)})),$("#org_card_tree .ui-fancytree").scroll((function(){card_title_resize($("#org_card_tree"),init.move_tree_scroll_left,!1)})),$("#morg_move_tree .ui-fancytree").scroll((function(){card_title_resize($("#morg_move_tree"),init.move_tree_scroll_left,!1)})),$(document).on("show.bs.modal","#card_create_modal",(function(){$(this).localize()})),$(document).on("shown.bs.modal","#card_create_modal",(function(){$("#create_card_input").focus()})),$(document).on("keydown","#card_create_modal #create_card_input",(function(e){if(13==e.keyCode){let e=$(this).parents("#card_create_modal").data("tree_type");e==tree_data.enum_tree_type.card?card_set_create($(this),$(this).data("card_seq"),$(this).val()):e==tree_data.enum_tree_type.note&&note_set_create($(this),$(this).data("card_seq"),$(this).val())}})),$(document).on("click","#card_create_modal #create_card_btn",(function(){let e=$(this).parents("#card_create_modal").data("tree_type"),t=$("#card_create_modal #create_card_input").val();e==tree_data.enum_tree_type.card?card_set_create($("#card_create_modal #create_card_input"),$(this).data("card_seq"),t):e==tree_data.enum_tree_type.note&&note_set_create($("#card_create_modal #create_card_input"),$(this).data("card_seq"),t),$("#card_create_modal #create_card_input").focus()})),$(document).on("click","#card_create_modal #create_card_close_btn",(function(){let e=$(this).parents("#card_create_modal").data("tree_type"),t=$("#card_create_modal #create_card_input").val();e==tree_data.enum_tree_type.card?card_set_create($("#card_create_modal #create_card_input"),$(this).data("card_seq"),t):e==tree_data.enum_tree_type.note&&note_set_create($("#card_create_modal #create_card_input"),$(this).data("card_seq"),t),$("#card_create_modal").modal("hide")})),$(document).on("click","#tree #state_icon.state_icon",(function(){$(this).next().trigger("click")})),$(document).on("show.bs.modal","#card_title_modal",(function(){$(this).localize()})),$(document).on("shown.bs.modal","#card_title_modal",(function(){$("#title_card_input").focus()})),$(document).on("keydown","#card_title_modal #title_card_input",(function(e){if(13==e.keyCode){let e=$(this).parents("#card_title_modal").data("tree_type"),t=$("#card_title_modal #title_card_input").val().trim();e==tree_data.enum_tree_type.card?card_set_title(t,$(this).data("card_seq")):e==tree_data.enum_tree_type.note&&note_set_title(t,$(this).data("card_seq"))}})),$(document).on("click","#card_title_modal #title_card_btn",(function(){let e=$(this).parents("#card_title_modal").data("tree_type"),t=$("#card_title_modal #title_card_input").val().trim();e==tree_data.enum_tree_type.card?card_set_title(t,$(this).data("card_seq")):e==tree_data.enum_tree_type.note&&note_set_title(t,$(this).data("card_seq")),$("#card_title_modal #title_card_input").focus()})),$(document).on("click","#card_title_modal #title_card_close_btn",(function(){let e=$(this).parents("#card_title_modal").data("tree_type"),t=$("#card_title_modal #title_card_input").val().trim();e==tree_data.enum_tree_type.card?card_set_title(t,$(this).data("card_seq")):e==tree_data.enum_tree_type.note&&note_set_title(t,$(this).data("card_seq")),$("#card_title_modal").modal("hide")}));